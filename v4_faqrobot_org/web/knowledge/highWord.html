<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8" />
    <title>后台管理系统</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <meta content="" name="description" />
    <meta content="" name="author" />

    <!-- ================== BEGIN BASE CSS STYLE ================== -->
    <link href="../../assets/plugins/jquery-ui/themes/base/minified/jquery-ui.min.css" rel="stylesheet" />
    <link href="../../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../../assets/css/animate.min.css" rel="stylesheet" />
    <link href="../../assets/css/style.min.css" rel="stylesheet" />
    <link href="../../assets/plugins/gritter/css/jquery.gritter.css" rel="stylesheet" />
    <link href="../../assets/css/style-responsive.min.css" rel="stylesheet" />
    <link href="../../assets/css/theme/default.css" rel="stylesheet" id="theme" />
    <!-- ================== END BASE CSS STYLE ================== -->
	<link href="../common/css/zTreeStyleTest.css" rel="stylesheet">
	<link href="../common/css/commonCSS.css" rel="stylesheet">
    <style>
        div .jp-interface {
            background-color: #F0F0F0;
        }
		.nav-pills>li.active>a, .nav-pills>li.active>a:focus, .nav-pills>li.active>a:hover {
			background: #fff;
			border: #2A72B5 1px solid;
			color: #2a72b5;
		}
        /* .webuploader-pick {
            width: 100px;
        }
        .webuploader-pick:before {
            position: absolute;
            left: 15px;
        }
        .webuploader-pick div {
            position: absolute;
            right: 15px;
        } */
        .resultTypeDetail {
            display: none;
        }
        h4 {
            padding: 10px 0px 5px 0px;
        }

        @charset "utf-8";

.table>tbody {
}
th {
}
.table>tbody>tr>td {
    vertical-align: middle;
}
td input {
    cursor: pointer;
}
.table>tbody>tr>td img {
    max-width: 100px;
    cursor: pointer;
}
.table>tbody>tr>td img:hover {
    box-shadow: 0 0 2px #888888;;
}
.one-del-addSrc {
    cursor: pointer;
}
input.text-error {
    border: 1px solid;
    background: #ffdedd none repeat scroll 0 0 !important;
    border-color: #ff5b57 !important;
}

textarea.text-error {
    border: 1px solid;
    background: #ffdedd none repeat scroll 0 0 !important;
    border-color: #ff5b57 !important;
}

label.text-error {
    font-weight: bold;
    color: #EA5200;
}

.paginator-text-right {
    float: none;
    text-align: right;
    width: 100%;
}
.search-addSrc {
    padding: 0;
    padding-bottom: 20px;
}
.jp-audio {
    width: auto;
}
.jp-audio .jp-controls {
    width: 300px;
}
.jp-interface {
    background-color: #fff;
}
.jp-audio, .jp-audio-stream, .jp-video {
    border: none;
    background-color: #fff;
}
.modal-video-addSrc {
    width: 670px;
}
.holder {
    margin: 0;
    margin-right: 12px;
}
.holder a {
    border-radius: 3px;
    display: inline-block;
    width: 29px;
    line-height: 29px;
    height: 29px;
    text-align: center;
    border-color: #e2e7eb;
    border: 1px solid #ddd;
    text-decoration: none;
}
.holder a.jp-current, a.jp-current:hover {
    color: #fff;
    border: 1px solid #242a30;
}
.holder .jp-current {
    color: #fff;
    background: #242a30!important;
    border: 1px solid #242a30;
}
.holder .jp-previous, .holder .jp-next {
    background: none;
    width: 58px;
}
.goPage-addSrc input, .goPage-addSrc a  {
    border-radius: 3px;
    display: inline-block;
    width: 46px;
    line-height: 29px;
    height: 29px;
    text-align: center;
    border: 1px solid #ddd;
    text-decoration: none;
    color: #333;
    vertical-align: middle;
    outline: none;
}
.goPage-addSrc input  {
    width: 29px;
}
.goPage-addSrc a:hover  {
    color: #fff;
    background: #242a30;
    border: 1px solid #242a30;
}
.add-src {
    vertical-align: -14px;
}
.add-src:before {
    content: none;
}
.add-src .webuploader-pick {
    height: 34px;
    line-height: 21px;
	font-size:14px;
	font-weight:300;
	font-family:"微软雅黑"
}

.gallery .image {
    display: inline-block;
    padding: 0 25px 10px 0;
    cursor: pointer;
}
.gallery .image-info .title {
    display: inline-block;
    vertical-align: middle;
    margin-right: 10px;
}
.gallery .image-info {
    padding: 5px;
}
.gallery .image a {
    vertical-align: middle;
}
.gallery .image .imageCtn-viewSrc {
    padding: 0;
    border: 1px solid #E2E7EB;
    margin-right: 0;
    border-radius: 5px;
}
.jp-playlist {
    max-height: 150px;
    overflow: auto;
}
.rowNav {
    margin: 0 -12px;
}

.imgSrcCtn {
    width: 300px;
    border-radius: 5px;
    border: 1px solid #D9E0E7;
    padding: 16px;
    margin-bottom: 20px;
	position: relative;
}
.imgSrcCtn img {
    width: 100%;
}
.outerTitle, .innerTitle {
    font-size: 15px;
}
.srcEditCtn {
    display: inline-block;
    width: 100%;
}
.srcEditCtn i {
    display: inline-block;
    width: 130px;
    text-align: center;
}
.srcLeft {
    float: left;
}
.srcRight {
    float: right;
}
.imgSrcCtn img {
    width: 100%;
    min-height: 50px;
}
.outerSrcCtn {
    height: 200px;
    overflow: hidden;
    border-bottom: 1px solid #D9E0E7;
}
.innerSrcCtn {
    position: relative;
    border-bottom: 1px solid #D9E0E7;
    height: 70px;
}
.innerSrcCtn .innerTitle {
    position: absolute;
    top: 25px;
    left: 0;
}
.innerSrcCtn:after {
    display: block;
    content: '';
    clear: both;
}
.innerSrcCtn .innerImg {
    margin-top: 10px;
    width: 50px;
    height: 50px;
    min-height: auto;
    float: right;
}
.timeStr {
    text-indent: 75px;
	position: relative;
}





    </style>
</head>
<body>
    <div class="modal fade in" style="padding-right: 17px;" id="analysisProgress"><div class="modal-backdrop fade in" style="height: 5000px;"></div>
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                    <h4 class="modal-title">处理结果</h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="a">
                            <div class="form-group">
                                <label class="col-md-2 control-label">名称</label>
                                <div class="col-md-10">
                                    <p class="name">123</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">大小</label>
                                <div class="col-md-10">
                                    <p class="size">123</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">完成时间</label>
                                <div class="col-md-10">
                                    <p class="finishTime">123</p>
                                </div>
                            </div>
                        </div>
                        <div class="b">
                            <div class="form-group">
                                <label class="col-md-2 control-label">任务编码</label>
                                <div class="col-md-10">
                                    <input type="text" class="form-control" name="keyCode">
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button class="path btn btn-sm btn-primary" href="javascript:;">下载结果</button>
                    <a data-dismiss="modal" class="btn btn-sm btn-white" href="javascript:;">取消</a>
                </div>
            </div>
        </div>
    </div>

    <div id="page-container" class="fade in">
        <div id="content" class="content">
            <!-- begin breadcrumb -->
            <ol class="breadcrumb pull-right">
                <li><a href="javascript:;">首页</a></li>
                <li><a href="javascript:;">素材管理</a></li>
                <li>文本分析</li>
            </ol>
            <!-- end breadcrumb -->
            <!-- begin page-header -->
            <h1 class="page-header">文本分析</h1>
            <!-- end page-header -->

            <!-- begin row -->
            <div class="row">
                    <!-- begin panel -->
                    <div class="panel panel-inverse" data-sortable-id="table-basic-7">
                        <div class="">
                            <div class="table-responsive">
                                <div class="panel-body">
			<div class="row">
                <div class="col-md-12" style="padding: 0;">
                    <div class="tab-content col-md-12" style="position: relative; margin-bottom: -15px; padding-left: 0; padding-right: 0; padding-top: 0;">
                        <div class="tab-addSrc">
                            
                        </div>
                        <form id="excel" class="">
                            <!-- <h4 class="media-heading">Excel设置</h4>
                            <div class="form-group col-md-12">
                                <label class="control-label col-md-1">所在工作表下标<span class="red">&nbsp;</span></label>
                                <div class="col-md-7">
                                    <input type="text" class="form-control" name="inputSheetId">
                                </div>
                            </div>
                            <div class="form-group col-md-12">
                                <label class="control-label col-md-1">文本所在列<span class="red">&nbsp;</span></label>
                                <div class="col-md-7">
                                    <input type="text" class="form-control" name="inputColumnIds">
                                </div>
                            </div> -->
                        </form>
                        <form id="save" class="">
                            <h4 class="media-heading" style="margin-top: -10px;">保存时长设置</h4>
                            <div class="form-group col-md-12" style="display: block;">
                                <label class="control-label col-md-1">时长<span class="red">&nbsp;</span></label>
                                <div class="form-group col-md-7" style="margin-top: -15px; margin-bottom: 0;">　
                                    <select name="storeType" class="form-control">
                                        <option value="0">永久保存</option>
                                        <option value="1">仅保存结果</option>
                                        <option value="2">保存源文件和结果</option>
                                        <option value="3">结果仅保存三天</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                        <form class="form-inline">
                            <h4 class="media-heading" style="margin-top: 44px;">输出结果</h4>
                            <div class="form-group">
                                <input class="resultType" type="checkbox" name="hifreqword" />
                                <label class="control-label">统计高频词<span class="red">&nbsp;</span></label>
                            </div>
                            <div class="form-group">
                                <input class="resultType" type="checkbox" name="hifreqsentence" />
                                <label class="control-label">统计高频句<span class="red">&nbsp;</span></label>
                            </div>
                            <div class="form-group">
                                <input class="resultType" type="checkbox" name="newword" />
                                <label class="control-label">新词发现<span class="red">&nbsp;</span></label>
                            </div>
                            <div class="form-group">
                                <input class="resultType" type="checkbox" name="hifreqsynonym" />
                                <label class="control-label">高频词同义词<span class="red">&nbsp;</span></label>
                            </div>
                            <div class="form-group">
                                <input class="resultType" type="checkbox" name="seg" />
                                <label class="control-label">分词<span class="red">&nbsp;</span></label>
                            </div>
                        </form>
                        <!-- 小片段这里开始 -->
                        <form id="hifreqword" class="">
                            <div class="hifreqword resultTypeDetail">
                                <h4 class="media-heading">高频词统计参数设置</h4>
                                <div class="form-group col-md-12">
                                    <label class="control-label col-md-1">最少出现次数<span class="red">&nbsp;</span></label>
                                    <div class="col-md-7">
                                        <input type="text" class="form-control" name="wordfreqMinFreq" value="2">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="hifreqsentence" class="">
                            <div class="hifreqsentence resultTypeDetail">
                                <h4 class="media-heading">高频句提取参数设置</h4>
                                <div class="form-group col-md-12">
                                    <label class="control-label col-md-1">最少出现次数<span class="red">&nbsp;</span></label>
                                    <div class="col-md-7">
                                        <input type="text" class="form-control" name="sentfreqMinFreq" value="2">
                                    </div>
                                </div>
                                <div class="form-group col-md-12">
                                    <label class="control-label col-md-1">最少词数<span class="red">&nbsp;</span></label>
                                    <div class="col-md-7">
                                        <input type="text" class="form-control" name="hifreqsentenceMinFreq" value="2">
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="newword" class="">
                            <div class="newword resultTypeDetail">
                                <h4 class="media-heading">新词发现参数设置</h4>
                                <div class="form-group col-md-12">
                                    <div class="form-group col-md-1">
                                        <label class="control-label">包含多字词的组合<span class="red">&nbsp;</span></label>
                                    </div>
                                    <div class="form-group col-md-1">
                                        <input type="checkbox" name="newwordIncludePhrase">
                                    </div>
                                    <div class="form-group col-md-1">
                                        <label class="control-label">包含数字、字母词<span class="red">&nbsp;</span></label>
                                    </div>
                                    <div class="form-group col-md-1">
                                        <input type="checkbox" name="newwordIncludeNums">
                                    </div>
                                </div>
                                <div class="form-group col-md-12">
                                    <label class="control-label col-md-1">最多识别新词数<span class="red">&nbsp;</span></label>
                                    <div class="col-md-7">
                                        <input type="text" class="form-control" name="newwordMaxCount" value="100">
                                    </div>
                                </div>
                                <div class="form-group col-md-12">
                                    <label class="control-label col-md-1">最少出现次数<span class="red">&nbsp;</span></label>
                                    <div class="col-md-7">
                                        <input type="text" class="form-control" name="newwordMinOccur" value="2">
                                    </div>
                                </div>
                                <div class="form-group col-md-12">
                                    <label class="control-label col-md-1">最大跨度<span class="red">&nbsp;</span></label>
                                    <div class="form-group col-md-7">
                                        <select name="newwordMaxSpan" class="form-control">
                                            <option value="2">2个片段</option>
                                            <option value="3" selected>3个片段</option>
                                            <option value="4">4个片段</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form id="hifreqsynonym" class="">
                            <div class="hifreqsynonym resultTypeDetail">
                                <h4 class="media-heading">高频词同义词参数设置</h4>
                                <div class="form-group col-md-12">
                                    <label class="control-label col-md-1">最少出现次数<span class="red">&nbsp;</span></label>
                                    <div class="col-md-7">
                                        <input type="text" class="form-control" name="hifreqsynonymMinOccur" value="2">
                                    </div>
                                </div>
                            </div>
                        </form>
		    <div class="row">	
                        <a style="margin-right:0;" href="javascript:;" class="add-src">选择文件</a>
                        <button type="button" class="startBtn btn btn-primary" style="margin: 15px 0;">开始上传</button>
                        <a href="entitySelect.html" class="btn btn-primary" style="margin:15px 15px 15px 1px;" data-num="0">实体选择</a>
		      <a style="margin-top:15px" class="btn btn-default pull-right" target="_blank" href="js/faqrobot20170217.xlsx">
                           <i class="glyphicon glyphicon-download"></i>
                           <span>下载模板</span>
                         </a>
		    </div>	                        
		      <div class="progress progress-striped active">
                            <div class="progress-bar"></div>
                        </div>
                        <div class="note note-info" style="display: none;"></div>
                        <div style="display: none;">
                            <button class="download btn btn-primary" href="javascript:;"><i class="glyphicon glyphicon-download"></i> 下载结果</button>
                        </div>

                        <table class="table" style="margin-top: 0" id="qsf">
                            <thead>
                                <tr>
                                    <th>唯一编码</th>
                                    <th>名称</th>
                                    <th width="100">大小</th>
                                    <th width="140">完成时间</th>
                                    <th style="width: 60px">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                        <div id="itemContainer"></div>
                    </div>
                </div>
			</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end panel -->
            </div>
            <!-- end row -->
        </div>
        <!-- begin scroll to top btn -->
        <a href="javascript:;" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top"><i class="fa fa-angle-up"></i></a>
        <!-- end scroll to top btn -->
    </div>
    <!-- ================== BEGIN BASE JS ================== -->
    <script src="../../assets/plugins/jquery/jquery-1.9.1.min.js"></script>
    <script src="../../assets/plugins/jquery/jquery-migrate-1.1.0.min.js"></script>
    <script src="../../assets/plugins/jquery-ui/ui/minified/jquery-ui.min.js"></script>
    <script src="../../assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <!--[if lt IE 9]>
        <script src="../../assets/crossbrowserjs/html5shiv.js"></script>
        <script src="../../assets/crossbrowserjs/respond.min.js"></script>
        <script src="../../assets/crossbrowserjs/excanvas.min.js"></script>
    <![endif]-->
    <script src="../../assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <script src="../../assets/plugins/jquery-cookie/jquery.cookie.js"></script>
    <!-- ================== END BASE JS ================== -->

    <!-- ================== BEGIN PAGE LEVEL JS ================== -->
    <script src="../../assets/js/apps.min.js"></script>
    <!-- ================== END PAGE LEVEL JS ================== -->

    <!-- 必加开始 -->
    <link rel="stylesheet" href="../common/css/webuploader.css">
    <link rel="stylesheet" href="../common/css/radioskin/blue.css">
    <link href="../../assets/plugins/lightbox/css/lightbox.css" rel="stylesheet" />
    <link href="../common/css/skin/blue.monday/jplayer.blue.monday.css" rel="stylesheet" type="text/css" />
    <link href="css/style.css" rel="stylesheet" />

    <script src="../../assets/plugins/gritter/js/jquery.gritter.js"></script>
    <script src="../../assets/plugins/lightbox/js/lightbox-2.6.min.js"></script>
    <script src="../common/js/jquery.jplayer.min.js"></script>
	<script src="../common/js/jquery.ztree.all-3.5.js"></script>
	<script src="../common/js/jquery.validate.js"></script>
  <script src="../common/js/iframeTab.min.js"></script>
    <script src="../common/js/icheck.js"></script>
    <script src="../common/js/bootstrap-paginator.js"></script>
    <script src="../common/js/webuploader.min.js"></script>
    <script src="../common/js/customMethod.js"></script>
    <script src="../common/js/base.js"></script>
    <!-- 必加结束 -->

  <script>
		$(document).ready(function() {
			App.init();			
		});
	</script>


</body>
<script>

iframeTab.init({iframeBox: ''});
;$(function() {
        var This = this;
        var pageNo = 1,//当前页
            pageSize = 10,//每页数量
            timer = null;

        var resultType = '';

        // 拼接输出结果
        function getResultType() {
            resultType = '';
            $('.resultType').each(function() {
                if($(this).prop('checked')) {
                    resultType += $(this).attr('name') +',';
                }
            });
            return resultType;
        }
        function getParams() {
            var params = '';
            $('.resultType').each(function() {
                if($(this).prop('checked')) {
                    params += $('#'+ $(this).attr('name')).serialize() +'&';
                }
            });
            params += $('#excel').serialize() +'&';
            params += $('#save').serialize();
            return params;
        }

        $('th').on('click', function() {
            getSeriData()
        })

        // 显隐
        $('.resultType').on('ifChanged', function() {
            var $This = $('.'+ $(this).attr('name'));
            if($(this).prop('checked')) {// 选中
                $This.show();
            }else {// 未选中
                $This.hide();
            }
        })

        initSrc();
        function initSrc() {
      	$('#qsf').tableAjaxLoader2(7);
            Base.request({
                url: 'WordsProcess/WordsProcessList',
                params: {
                    pageNo: pageNo,//当前页
                    pageSize: pageSize,//每页数量
                },
                callback: function(data) {
                    if(data.status) {
                        Base.gritter(data.message, false);
                    }else {
                        var html ='';
                        if(data.questionList) {
                            if(data.questionList[0]) {
                                for(var i=0; i<data.questionList.length; i++) {
                                    html += '<tr KeyCode="'+ (data.questionList[i].KeyCode || '') +'"><td>'+ (data.questionList[i].KeyCode || '') +'</td><td>'+ (data.questionList[i].SourceFileName || '') +'</td><td>'+ formatSize((data.questionList[i].SourceFileSize || '')) +'</td><td>'+ (data.questionList[i].TaskFinishTime || '') +'</td><td><a href="../../wordsProcess/downloadWordsProcess?keyCode='+ (data.questionList[i].KeyCode || '') +'"><i class="timeTip downloadFile glyphicon glyphicon-download" data-original-title="下载"></i></a></td></tr>';
                                }

                                var options = {
                                    data: [data, 'questionList', 'total'],
                                    currentPage: data.currentPage,
                                    totalPages: data.totlePages ? data.totlePages : 1,
                                    alignment: 'right',
                                    onPageClicked: function(event, originalEvent, type, page) {
                                        pageNo = page;
                                        initSrc();
                                    }
                                };
                                $('#itemContainer').bootstrapPaginator(options);
                            }else {
                                html += '<tr><td colspan="7" style="text-align:center;"><i class="glyphicon glyphicon-warning-sign"></i>&nbsp;&nbsp;当前纪录为空！</td></tr>';
                                $('#itemContainer').empty();
                            }
                        }
                        $('tbody').empty().append(html);
                        $('.timeTip').tooltip();
                    }
                },
            });
        }

        /*// 下载文件
        $('body').on('click', '.downloadFile', function() {
            var $tr = $(this).parents('tr');
            window.open('../../wordsProcess/downloadWordsProcess?keyCode='+ , '_blank');
        })*/

        //上传素材
        var uploader = null;

        $('.progress-striped').hide();
        $('.tab-addSrc').hide();
        $('.tab-addSrc').eq(0).show();

        resetUploader(0, 1);
        //重新生成uploader
        function resetUploader(i, fileNumLimit) {
            if(uploader) {
                uploader.destroy();
            }
            //上传素材
            uploader = WebUploader.create({
                server: '../../wordsProcess/importWordsProcess',
                swf: '../common/js/Uploader.swf',
                pick: $('.add-src').eq(i),
                fileNumLimit: fileNumLimit,
                duplicate: true,
                //auto: true,
                /*accept:{
                    extensions:'gif,jpg,jpeg,png',//可接受的文件后缀名
                    mimeTypes:'image/*'
                },*/
            });
            //加入队列之前
            uploader.on( 'beforeFileQueued', function( file ) {
                if(!file.size) {
                    Base.gritter('文件大小为空！', false);
                    uploader.cancelFile(file);
                }
            });
            //获取服务端返回的数据
            uploader.on( 'uploadAccept', function( object, data ) {
                if(data.status) {
                    Base.gritter(data.message, false);
                }else {
                    Base.gritter(data.result.message, true);
                    Base.gritter('任务编码：'+ data.result.taskKeyCode, true);
                    $('[name=keyCode]').val(data.result.taskKeyCode || ''),
                    checkSchedule();
                }
            });

            // 获取机器人返回进度
            function checkSchedule() {
                setTimeout(function() {
                    Base.request({
                        url: 'wordsProcess/checkSchedule',
                        params: {
                            keyCode: $('[name=keyCode]').val() || '',
                        },
                        callback: function(data) {
                            if(data.status) {
                                Base.gritter(data.message, false);
                            }else {
                                if(data.result.progress) {
                                    $('.progress-striped, .note').show();
                                    $('.note').text(data.result.progress.info);
                                    $('.progress-bar').css({'width': data.result.progress.progress*100 +'%'});

                                    if(data.result.progress.progress == 1) {
                                        $('.name').text(data.result.result.name);
                                        $('.size').text(formatSize(data.result.result.size));
                                        $('.finishTime').text(formatTime(data.result.result.finishTime/1000, true));
                                        $('#analysisProgress').modal('show');
                                        setTimeout(function() {
                                            $('.progress-striped, .note').hide();
                                        }, 1000)
                                    }else {
                                        checkSchedule();
                                    }
                                }
                            }
                        },
                    });
                }, 2000);
            }



            //上传开始
            uploader.on( 'startUpload', function( file, percentage ) {
                if(!getResultType()) {
                    Base.gritter('至少选择1项输出结果', false);
                    uploader.stop();
                }else {
                    $('.progress-striped').show();
                }
            });
            //上传进度
            uploader.on( 'uploadProgress', function( file, percentage ) {
                $('.progress-bar').css({'width': percentage*100 +'%'});
            });
            //限制单次上传数量
            uploader.on( 'uploadFinished', function( object, data ) {
                $('.progress-bar').css({'width': 0});
                $('.progress-striped').hide();
                uploader.reset();
            });
        }

        // 开始上传
        $('.startBtn').on('click', function() {
            uploader.option('formData', $.extend({
                resultType: getResultType(),
            }, Base.formatSeriData(getParams())))
            uploader.upload();
        })

        // 下载结果
        $('.path').on('click', function() {
            window.open('../../wordsProcess/downloadWordsProcess?keyCode='+ ($('[name=keyCode]').val() || ''), '_blank');
            //location.href = '../../wordsProcess/downloadWordsProcess?keyCode='+ ($('[name=keyCode]').val() || '');
            /*Base.request({
                url: 'wordsProcess/downloadWordsProcess',
                params: {
                    keyCode: $('[name=keyCode]').val() || '',
                },
                callback: function(data) {
                    if(data.status) {
                        Base.gritter(data.message, false);
                    }else {
                        Base.gritter(data.message, true);
                    }
                },
            });*/
        });

        $('#analysisProgress').on('hidden.bs.modal', function () {
            $('[name=keyCode]').val('');
        })

        // 弹出选择框
        $('.download').on('click', function() {
            $('#analysisProgress').modal('show');
            $('.a').hide();
            $('.b').show();
            $('[name=keyCode]').val('');
        });

        //格式化时间 true 214321421->2016-9-9 11:23
        function formatTime(time, bool) {
            if(!time) return '';
            if(bool) {//true
                var date = new Date(time*1000).toLocaleString().replace(/\//g, '-').replace(/:\d+$/, '')
                if(date.indexOf('下午')+1) {
                    var hour = date.match(/(\d+):/);
                    hour = +hour[1] + 12;
                    date = date.replace(/([\u4e00-\u9fa5]+)\d+(:)/, hour +'$2');
                }else {
                    date = date.replace(/[\u4e00-\u9fa5]+/, '');
                }
                return date;
            }else {
                return new Date(time).getTime()/1000;
            }
        }

        //将b转化为kb或m
        function formatSize(num) {
            return num;
            /*var kb = num/1024,
                mb = num/1024/1024;

            if(kb < 1024) {
                return kb.toFixed(1) +'KB';
            }else {
                return mb.toFixed(1) +'MB';
            }*/
        }

});
</script>
</html>
