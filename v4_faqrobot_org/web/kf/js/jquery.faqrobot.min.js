(function(b){b.fn.extend({faqrobot:function(k,c){c=b.extend({},b.FaqRobot.defaults,{sysNum:"number"==typeof k?k:1E4},c);return this.each(function(){new b.FaqRobot(this,c)})}});b.FaqRobot=function(k,c){function q(a,d,e,f,g){if("string"==typeof a&&0<a.length){var h={timestamp:+new Date,dataType:f||c.dataType},h=b.extend({},h,g);b.each(c.extraParams,function(a,d){h[a]="function"==typeof d?d():d});b.ajax({dataType:c.dataType,url:encodeURI(a),data:h,success:function(a){var b=c.parse&&c.parse(a)||a;0>b.status&&
"function"==typeof e?e(b):-1==b.status?toastr.error(a.message||"\u8bf7\u6c42\u4fe1\u606f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\uff01",opts):-2==b.status?toastr.error(b.message||"\u60a8\u7684\u4fe1\u606f\u8ba4\u8bc1\u672a\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1\uff01",opts):(keepCount=0,x(b),"function"==typeof d&&d(b))},error:function(){toastr.error("\u6570\u636e\u8bf7\u6c42\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\uff01",opts)}})}}function B(a){var d=b("<div/>").addClass("staff-msg");b("<div/>").addClass("name").appendTo(d).html(c.robotName);
b("<div/>").addClass("logoSize").html('<img class="img-circle" src='+c.kfUrl+">").appendTo(d);var e=b("<div/>").addClass("msg logoMsg").appendTo(d),f=b("<div/>").addClass("content").appendTo(e);b("<span/>").addClass("msg-status").appendTo(e);f.html("\u60a8\u597d\uff0c\u6211\u662f\u673a\u5668\u4eba"+a.webConfig.robotName+"\u3002"+a.webConfig.helloWord);l.html(d)}function C(a){c.topQuestionDiv&&2<c.topQuestionDiv.length&&"undefined"!=typeof a&&1<a.length&&u(c.topQuestionDiv,a)}function D(a){c.newQuestionDiv&&
2<c.newQuestionDiv.length&&"undefined"!=typeof a&&1<a.length&&u(c.newQuestionDiv,a)}function E(a){if(c.baseInfoDiv&&2<c.baseInfoDiv.length&&"undefined"!=typeof a.webConfig&&1<a.webConfig.length){var d='<div class="Contact_us"><strong>\u8054\u7cfb\u6211\u4eec\uff1a</strong>';"undefined"!=typeof a.webConfig.webName&&(d+="<p>\u540d\u79f0\uff1a"+a.webConfig.webName+"</p>");"undefined"!=typeof a.webConfig.serviceTel&&(d+="<p>\u7535\u8bdd\uff1a"+a.webConfig.serviceTel+"</p>");"undefined"!=typeof a.webConfig.webSite&&
(d+='<p>\u7f51\u5740\uff1a<a href="'+a.webConfig.webSite+'" target="_black">'+a.webConfig.webSite+"</a></p>");d+="</div>";b("#"+c.baseInfoDiv).html(d)}}function F(a){if(c.advInfoDiv&&2<c.advInfoDiv.length&&"undefined"!=typeof a.webConfig&&1<a.webConfig.length){var d="<table>";"undefined"!=typeof a.webConfig.serviceQq&&(d+='<tr><td>Q\u00a0Q\uff1a</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+a.webConfig.serviceQq+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+
a.webConfig.serviceQq+':51" alt="QQ\u5728\u7ebf\u5ba2\u670d" title="QQ\u5728\u7ebf\u5ba2\u670d"/></a></td></tr>');if("undefined"!=typeof a.advs)for(a=a.advs,i=0;i<a.length;i++){var e=b.trim(a[i].name),f=b.trim(a[i].value),g=a[i].type;0==g?d+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":1==g?d+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":2==g?d+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":3==g&&(d+="<tr><td>"+e+'\uff1a</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+f+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+
f+':51" alt="'+e+'" title="'+e+'"/></a></td></tr>')}d+="</table>";b("#"+c.advInfoDiv).html(d)}}function G(a,d){a&&2<a.length&&d&&0<d.length&&b("#"+a).html(d)}function u(a,d,e,f,g){if(!d)return"";a=b("<dl/>").appendTo(b("#"+a));e=H(d.length);for(f=0;f<e;f++)if(d[f]){g=b("<dt/>").html(f+1+".&nbsp;");var h=c.formatBaseQueCount&&c.formatBaseQueCount(d[f],f+1,e,c.queConMaxWordsCount)||I(d[f].question);!1!==h&&(b("<a/>").html(h).appendTo(g).attr("href","javascript:void(0)").attr("title",d[f].question).attr("aid",
d[f].solutionId).click(function(){$this=b(this);r($this.attr("title"),$this.attr("aid"));return!1}),g.appendTo(a))}}function I(a,d){return d?a.length>d?a.substring(0,d)+"...":a:a}function H(a){return c.maxTopQuestions&&c.maxTopQuestions<a?c.maxTopQuestions:a}function t(){var a=new Date,d=a.getFullYear(),b=a.getMonth()+1,c=a.getDate(),g=a.getHours(),h=a.getMinutes(),a=a.getSeconds();return d+"-"+b+"-"+c+" "+g+":"+h+":"+a}function J(a,d){v.fadeIn(800);v.find("span").html(a);v.delay(1E3).fadeTo("slow",
.2).fadeTo("slow",1).fadeOut(800,function(){"function"==typeof d&&d()})}function y(){var a;a=m.val();a=K(a,"html");""!=a&&a!=c.inputMagOldvalue&&(m.val(""),b(".ac_results").hide(),1==a.length&&0<a&&"undefined"!=typeof n[a-1]&&(a=n[a-1],n=[]),r(a),b("#"+c.wordremain).html(100),m.focus())}function K(a,d){if(!a)return 0===a?"0":"";switch(d){case "none":return a+"";case "html":return a.replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/ /g," ").replace(/\r\n/g,
"").replace(/\n/g,"").replace(/\r/g,"");case "htmlEp":return a.replace(/[&'"<>\/\\\-\x00-\x1f\x80-\xff]/g,function(a){return"&#"+a.charCodeAt(0)+";"});case "url":return escape(a).replace(/\+/g,"%2B");case "miniUrl":return a.replace(/%/g,"%25");case "script":return a.replace(/[\\"']/g,function(a){return"\\"+a}).replace(/%/g,"\\x25").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\x01/g,"\\x01");case "reg":return a.replace(/[\\\^\$\*\+\?\{\}\.\(\)\[\]]/g,function(a){return"\\"+a});default:return escape(a).replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,
function(a){return"&#"+a.charCodeAt(0)+";"}).replace(/ /g," ").replace(/\r\n/g,"<br />").replace(/\n/g,"<br />").replace(/\r/g,"<br />")}}function r(a,d){if(a&&0<a.length){var b=c.basePath+"AQ?s=aq";d&&0<d++&&(b+="&sId="+d+"&sysNum="+c.sysNum);w(a);q(b,p,0,c.dataType,{question:a})}}function w(a){if(a||0!=a.length){var d;(d=c.showMyWords&&c.showMyWords(a,t()))||(t(),d='<div  class="client-msg" data-type="text"><div class="logoSize" style="right:0"><img class="img-circle" alt="" src="images/head_user.png"></div><div class="msg rightLogo"><div class="content">'+
a+'</div><span class="msg-status"></span> </div> </div>');l.append(d);l.scrollTop(l[0].scrollHeight)}}function p(a){if(a||0!=a.length){var d;if(!(d=c.showRobotWords&&c.showRobotWords(a,t())))if(d=t(),"undefined"==typeof a.robotAnswer||0==a.robotAnswer.length)d="";else{for(var b,f,g=0;g<a.robotAnswer.length;g++)f=a.robotAnswer[g],f=L(f,d),b?b.after(f):b=f;d=b}l.append(d);l.scrollTop(l[0].scrollHeight)}}function L(a,d){var e="";d="";"undefined"!=typeof a.gusWords&&null!=a.gusWords?(e=""==a.gusWords.ydWords?
"\u60a8\u662f\u4e0d\u662f\u8981\u54a8\u8be2\u4e0b\u9762\u7684\u95ee\u9898\uff1f":a.gusWords.ydWords,d=""==a.gusWords.afterWords?"":a.gusWords.afterWords):(e="\u60a8\u662f\u4e0d\u662f\u8981\u54a8\u8be2\u4e0b\u9762\u7684\u95ee\u9898\uff1f",d="");if(!a)return"";var f=b("<div/>").addClass("staff-msg");b("<div/>").addClass("name").appendTo(f).html(c.robotName);b("<div/>").addClass("logoSize").html('<img class="img-circle" src='+c.kfUrl+">").appendTo(f);var g=b("<div/>").addClass("msg logoMsg").appendTo(f),
h=b("<div/>").addClass("content").appendTo(g);b("<div/>").addClass("content").appendTo(g);var l=b("<div/>").addClass("content").appendTo(g);b("<span/>").addClass("msg-status").appendTo(g);var k=b("<div/>").addClass("content").appendTo(g);if("undefined"!=typeof a.aId&&0!=a.aId){var g=a.aId,m=a.cluid;k.addClass("helper_aid_"+g).addClass("helper");b("<a/>").addClass("robot_review_yes").attr("helptag",1).attr("aid",g).attr("uid",m).click(z).html('<span class="robot_help_yes"></span>').appendTo(k);b("<a/>").addClass("robot_review_no").attr("helptag",
0).attr("aid",g).attr("uid",m).click(z).html('<span class="robot_help_no"></span>').appendTo(k)}"undefined"!=typeof a.relateLessList&&""!=a.relateLessList&&0<a.relateLessList.length&&(b("#"+c.sugQuestionDiv).html(""),u(c.sugQuestionDiv,a.relateLessList));""!=a.ansCon&&0<a.ansCon.length&&h.html(a.ansCon);if("undefined"!=typeof a.relateList&&0<a.relateList.length){h=b("<span/>").addClass("question").html(e).appendTo(l);k=a.relateList;e=b("<ol/>").appendTo(l);for(i=0;i<k.length;i++)a=b.trim(k[i].question),
g=k[i].solutionId,g=b("<li/>").appendTo(e),m=b("<a/>"),m.html(a).appendTo(g).attr("href","javascript:void(0)").attr("title",a).attr("aid",k[i].solutionId).click(function(){$this=b(this);r($this.attr("title"),$this.attr("aid"));return!1}),n[i]=a;b("<dt/>").html(d).appendTo(h);return f}if("undefined"!=typeof a.gusList&&0<a.gusList.length){h=b("<span/>").addClass("question").html(e).appendTo(l);e=b("<ol/>").appendTo(l);h=a.gusList;for(i=0;i<h.length;i++)a=b.trim(h[i].seedQuestion.question),g=h[i].solutionId,
g=b("<li/>").appendTo(e),m=b("<a/>"),m.html(a).appendTo(g).attr("href","javascript:void(0)").attr("title",a).attr("aid",h[i].solutionId).click(function(){$this=b(this);r($this.attr("title"),$this.attr("aid"));return!1}),n[i]=a;b("<span/>").addClass("question").html(d).appendTo(l);return f}if(""==a.ansCon)return h.html("\u00a0"),f;h.html(a.ansCon);return f}function M(){var a=c.basePath+"AQ?s=offline&nocache="+(new Date).getTime();b.getJSON(a,function(a){0==a.status&&p({message:"",robotAnswer:[{ansCon:"\u60a8\u7684\u4f1a\u8bdd\u5df2\u8fc7\u671f\uff0c\u5982\u9700\u518d\u6b21\u804a\u5929\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u6216\u5237\u65b0\u672c\u9875\u9762\uff01"}],
status:0})})}function x(a){"undefined"!=typeof a.tspan&&(s_tspan!=a.tspan&&(s_tspan=a.tspan),"undefined"!=typeof dt&&clearTimeout(dt),100>s_tspan&&240>keepCount?(keepCount++,dt=setTimeout(N,1E3*s_tspan)):M())}function N(){var a=b.trim(m.text());b.ajax({type:"post",datatype:"json",cache:!1,url:c.basePath+"AQ?s=kl",data:"question="+encodeURI(a),success:function(a){0==a.status&&(x(a),a.robotAnswer&&0<a.robotAnswer.length&&p(a))}})}function z(){$this=b(this);var a=$this.attr("aid"),d=$this.attr("uid"),
e=$this.attr("helptag");b(".helper_aid_"+a).html("\u611f\u8c22\u60a8\u7684\u8bc4\u4ef7\uff01");q(1==e?c.basePath+"AQ?s=addufc&aId="+a+"&sysNum="+c.sysNum+"&cluid="+d:c.basePath+"AQ?s=addulc&aId="+a+"&sysNum="+c.sysNum+"&cluid="+d)}function O(){$this=b(this);var a=$this.parents("form"),d=c.basePath+"AQ?s=fadeback&sysNum="+c.sysNum,e="",f=b("input[name='reason[]']");for(i=0;i<f.length;i++)f[i].checked&&(e+=f[i].value+",");a.find("input[name=sub]").val(e);b.ajax({type:"get",datatype:"json",cache:!1,
url:encodeURI(d),data:a.serialize(),success:function(d){b(".fadeBackModal").fadeOut(800);b(".fadeBackContent").fadeOut(800);a[0].reset();J(d.message)}})}var n=[],l=b("#"+c.chatContDiv);l.parent();var m=b(k),v=b("#"+c.showErrorId);k=window.location.href.split("?");var A=[],A="undefined"!=typeof k[1]&&-1!==k[1].indexOf("jid=")?k[1].split("&"):[""];m.focus(function(){b(this).val()==b(this).attr("oldvalue")&&b(this).val("");b(this).css("color","#333");b(this).parent().addClass("robot_inputon")}).blur(function(){""==
b(this).val()?(b(this).val(b(this).attr("oldvalue")),b(this).css("color","#ccc")):b(this).css("color","#333");b(this).parent().removeClass("robot_inputon")}).autocomplete(c.basePath+"AQ?s=ig&sysNum="+c.sysNum,{max:10,delay:500,matchSubset:!1,scroll:!1,minChars:2,scrollHeight:400,dataType:"json",selectFirst:!1,highlight:function(a,d){d=d.split("");var c="";b.each(d,function(b,d){-1==c.indexOf(d)&&(c+=d,a=a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+d.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,
"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"))});return a.replace("<strong></strong>","")},parse:function(a){for(var b=[],c=0;c<a.list.length;c++)b[b.length]={data:a.list[c],result:a.list[c].question};return b},formatItem:function(a,b,c){return b+". "+a.question},formatMatch:function(a,b,c){return a},formatResult:function(a){return a}}).result(function(a,b,c){a.preventDefault()}).keyup(function(a){a=a||window.event;27==a.keyCode&&b(this).unautocomplete();return(isHotKey=!a.ctrlKey&&
13==a.keyCode||a.ctrlKey&&13==a.keyCode)?(y(),!1):!0}).keydown(function(){var a=this.value.length,d=0,e=this.value.match(/[\u4E00-\u9FA5\uF900-\uFA2D]/g);null!=e&&(d+=e.length);a=b(this).attr("maxLength")-d-a;if(0>=a){a=0;d=this.value.substring(0,this.maxLength);for(e=0;e<d.length&&!(a+=/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(d.charAt(e))?2:1,a>this.maxLength);e++);this.value=d.substring(0,e);b("#"+c.wordremain).html(0)}else b("#"+c.wordremain).html(a)});c.fadeBackId&&2<c.fadeBackId.length&&b("#"+c.fadeBackId).click(O);
b("#"+c.chatContDiv).on("click",".wflink",function(){$this=b(this);var a=$this.attr("rel"),d=$this.html(),a=c.basePath+"AQ?s=getflw&sysNum="+c.sysNum+"&question="+encodeURI(d)+"&fid="+a+"&nocache="+(new Date).getTime();b.getJSON(a,function(a){0==a.status?(w(d),p(a)):toastr.error(a.message,opts)})});b("#"+c.chatContDiv).on("click",".faqevent",function(){var a=b(this).attr("href"),d=b(this).html(),a=c.basePath+"AQ?"+a+"&sysNum="+c.sysNum+"&nocache="+(new Date).getTime();w(d);q(a,p,0,c.dataType,{});
return!1});-1!==window.location.href.indexOf("sysNum=")&&(c.sysNum=window.location.href.split("sysNum=")[1].replace("#",""));m.attr("value",c.inputMagOldvalue);m.attr("oldvalue",c.inputMagOldvalue);m.val(c.inputMagOldvalue);q(c.basePath+"AQ?s=p&sysNum="+c.sysNum+"&"+A[0],function(a){urlId=location.href.split("?");if(-1==a.status)toastr.error("\u7f51\u7edc\u6709\u70b9\u4e0d\u7ed9\u529b\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u5c1d\u8bd5\u3002",opts);else if(-2==a.status)toastr.error("\u60a8\u7684\u4fe1\u606f\u8ba4\u8bc1\u672a\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1\u3002",
opts),location.href=a.loginurl;else{"undefined"!=typeof a.webConfig.robotName&&(c.robotName=a.webConfig.robotName);"undefined"!=typeof a.webConfig.logoUrl&&(c.logoUrl=""==a.webConfig.logoUrl?"images/logo.png":a.webConfig.logoUrl,b("#"+c.logoDiv).attr("src",c.logoUrl));"undefined"!=typeof a.skinConfig?("undefined"!=typeof a.skinConfig.kfPic&&(c.kfUrl=""==a.skinConfig.kfPic?"images/head.png":a.skinConfig.kfPic),"undefined"!=typeof a.skinConfig.khPic&&(c.khUrl=""==a.skinConfig.khPic?c.khUrl:a.skinConfig.khPic)):
c.kfUrl="images/head.png";var d=c.formatWebLog&&c.formatWebLog(a)||(c.logoDiv&&2<c.logoDiv.length&&"undefined"!=typeof a.logo&&20<a.logo.length?'<a href="'+("undefined"!=typeof a.webSite?a.webSite:"#")+'" target="_black"><img class="logo" alt="'+("undefined"!=typeof a.webName?a.webName:"logo")+'" src="'+a.logo+'"/></a>':"");G(c.logoDiv,d);B(a);C(a.topAsk);D(a.newAdd);E(a.webConfig);F(a);b("#"+c.sendBtn).click(function(){y()});b("#"+c.clearScreen).click(function(){var a=b("<div/>").addClass("staff-msg"),
c=l.find("div").first().html();l.html("");a.html(c).appendTo(l)})}})};b.FaqRobot.defaults={basePath:"./",sysNum:2E6,robotName:"FaqRobot",logoDiv:"weblogo",chatContDiv:"chatContentDiv",inputMsgArea:"inputMessage",inputMagOldvalue:"inputMagOldvalue",sendBtn:"sendBtn",closeBtn:"closeBtn",baseInfoDiv:"Contact_us",advInfoDiv:"advInfoDiv",topQuestionDiv:"topQuestions",newQuestionDiv:"newQuestions",sugQuestionDiv:"sugQuestions",viewUrlDiv:"viewUrlDiv",dataType:"json",extraParams:"",webUrl:"http://www.faqrobot.org",
authUrl:"",maxTopQuestions:7,queConMaxWordsCount:0,showMyWords:function(b,c){},showRobotWords:!1,autoswitch:0,wordremain:"wordremain",clearScreen:"clearScreen",fadeBackId:"fadeBackId",showErrorId:"showErrorId",kfUrl:"images/head.png",khUrl:"images/head_user.png",formatWebLog:!1,formatBaseQueCount:!1,showErrorMsg:!1}})(jQuery);