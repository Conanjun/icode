<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta charset="utf-8" />
	<title>转人工配置功能</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />

	<!-- ================== BEGIN BASE CSS STYLE ================== -->
	<link href="../../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
	<link href="../../assets/css/animate.min.css" rel="stylesheet" />
	<link href="../../assets/css/style.min.css" rel="stylesheet" />
	<link href="../../assets/css/style-responsive.min.css" rel="stylesheet" />
	<link href="../../assets/css/theme/default.css" rel="stylesheet" id="theme" />
	<link href="../../assets/plugins/jquery-ui/themes/base/minified/jquery-ui.min.css" rel="stylesheet" />
	<link href="../../assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
	<link href="../../assets/plugins/gritter/css/jquery.gritter.css" rel="stylesheet" />
	<!-- ================== END BASE CSS STYLE ================== -->

	<link href="../../assets/plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet" />
	<link href="../common/css/radioskin/blue.css" rel="stylesheet">
	<link href="../common/css/commonCSS.css" rel="stylesheet">
</head>

<body class="pace-done">
	<div class="fade in hide" id="page-loader"><span class="spinner"></span></div>
	<div id="page-container" class="fade in">
		<div id="content" class="content">
			<ol class="breadcrumb pull-right">
				<li><a href="javascript:;">首页</a></li>
				<li><a href="javascript:;">系统配置</a></li>
				<li class="active">转人工配置功能</li>
			</ol>
			<div class="row">
				<h1 class="page-header">转人工配置功能</h1>
				<div class="panel">
					<div class="panel-body">
						<div class="tableHead" style="height:34px;">
              <a data-toggle="modal" class="btn btn-primary" href="#addModal">
                <i class="glyphicon glyphicon-plus"></i>
                <span>添加转人工</span>
              </a>
							<a href="javascript:void(0);" class="btn btn-primary" onclick="selectDel('','/TurnPeopleConfig/delete',listPage,'VpageList')"><span class="glyphicon glyphicon-trash"></span>&nbsp;批量删除</a>
						</div>
						<table class="table" id="visiterList">
							<thead>
								<tr>
									<th width="50"><input type="checkbox" name="select_rows" class="select_rows" data-tableid="visiterList"/></th>
									<th width="180">转人工Key</th>
									<th>转人工地址</th>
									<th width="120">转人工类型</th>
									<th width="240">添加时间</th>
									<th width="80">操作</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<div id="VpageList"></div>
					</div>
				</div>
			</div>
		</div>
		<a data-click="scroll-top" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" href="javascript:;"><i class="fa fa-angle-up"></i></a>
	</div>
  <div class="modal fade" id="addModal">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                  <h4 class="modal-title">添加转人工配置</h4>
              </div>
              <div class="modal-body">
                  <form class="form-horizontal" novalidate="novalidate" id="addForm">
                      <fieldset>
                          <div class="form-group">
                              <label class="col-md-3 control-label">转人工接口Key<span class="red">&nbsp;*</span></label>
                              <div class="col-md-7">
                                <select class="form-control" id="addKey" name="key">
                                </select>
                              </div>
                          </div>
                          <div class="form-group">
                              <label class="col-md-3 control-label">转人工地址<span class="red">&nbsp;*</span></label>
                              <div class="col-md-7">
                                  <input type="text" placeholder="请输入转人工地址" class="form-control" name="url">
                              </div>
                          </div>
                          <div class="form-group">
                              <label class="col-md-3 control-label">转人工消息类型<span class="red">&nbsp;*</span></label>
                              <div class="col-md-7">
                                <select class="form-control" id="addMsg" name="msgType">
                                </select>
                              </div>
                          </div>
                      </fieldset>
                  </form>
              </div>
              <div class="modal-footer">
                  <a href="javascript:;" class="btn btn-sm btn-primary" onclick="$('#addForm').submit()">确认</a>
                  <a href="javascript:;" class="btn btn-sm btn-white" data-dismiss="modal">取消</a>
              </div>
          </div>
      </div>
  </div>
  <div class="modal fade" id="editModal">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                  <h4 class="modal-title">编辑转人工配置</h4>
              </div>
              <div class="modal-body">
                  <form class="form-horizontal" novalidate="novalidate" id="editForm">
                      <fieldset>
                          <input type="hidden" name="id">
                          <div class="form-group">
                              <label class="col-md-3 control-label">转人工接口Key<span class="red">&nbsp;*</span></label>
                              <div class="col-md-7">
                                <select class="form-control" id="editKey" name="key">
                                </select>
                              </div>
                          </div>
                          <div class="form-group">
                              <label class="col-md-3 control-label">转人工地址<span class="red">&nbsp;*</span></label>
                              <div class="col-md-7">
                                  <input type="text" placeholder="请输入转人工地址" class="form-control" name="url">
                              </div>
                          </div>
                          <div class="form-group">
                              <label class="col-md-3 control-label">转人工消息类型<span class="red">&nbsp;*</span></label>
                              <div class="col-md-7">
                                <select class="form-control" id="editMsg" name="msgType">
                                </select>
                              </div>
                          </div>
                      </fieldset>
                  </form>
              </div>
              <div class="modal-footer">
                  <a href="javascript:;" class="btn btn-sm btn-primary" onclick="$('#editForm').submit()">确认</a>
                  <a href="javascript:;" class="btn btn-sm btn-white" data-dismiss="modal">取消</a>
              </div>
          </div>
      </div>
  </div>
    <!-- ================== BEGIN BASE JS ================== -->
	<script src="../../assets/plugins/jquery/jquery-1.9.1.min.js"></script>
	<script src="../../assets/plugins/jquery/jquery-migrate-1.1.0.min.js"></script>
	<script src="../../assets/plugins/jquery-ui/ui/minified/jquery-ui.min.js"></script>
	<script src="../../assets/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="../../assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script src="../../assets/plugins/gritter/js/jquery.gritter.js"></script>
	<script src="../../assets/js/apps.min.js"></script>
	<!--[if lt IE 9]>
		<script src="../../assets/crossbrowserjs/html5shiv.js"></script>
		<script src="../../assets/crossbrowserjs/respond.min.js"></script>
		<script src="../../assets/crossbrowserjs/excanvas.min.js"></script>
	<![endif]-->
	<!-- ================== END BASE JS ================== -->

	<script src="../../assets/plugins/bootstrap-select/bootstrap-select.min.js"></script>
	<script src="../common/js/bootstrap-paginator.js"></script>
	<script src="../common/js/jquery.validate.js"></script>
	<script src="../common/js/icheck.js"></script>
	<script src="../common/js/customMethod.js"></script>
	<script type="text/javascript">
    var jl1 = [];
    var jl2 = []
		$(document).ready(function() {
			App.init();
			icheckBindInit();
      $.getJSON('../../TurnPeopleConfig/getMsgType', function(data){
        if(data.status === 0) {
          jl1 = data.list;
          data.list.forEach(function(el){
            $('#addMsg').append('<option value="'+el.IntValue+'">'+el.CodeDesc+'</option>');
            $('#editMsg').append('<option value="'+el.IntValue+'">'+el.CodeDesc+'</option>');
          });
        }
      });
      $.getJSON('../../TurnPeopleConfig/getTurnPeopleKey', function(data){
        if(data.status === 0) {
          jl2 = data.list;
          data.list.forEach(function(el){
            $('#addKey').append('<option value="'+el.Key+'">'+el.KeyDesc+'</option>');
            $('#editKey').append('<option value="'+el.Key+'">'+el.KeyDesc+'</option>');
          });
        }
        listPage(1);
      });
			$('#addForm').validate({
				rules:{
					url:{
						required:true
					}
				},
				messages:{
					url:{
						required:"请输入转人工地址！"
					}
				},
				submitHandler: addWW
			});
			$('#editForm').validate({
				rules:{
					url:{
						required:true
					}
				},
				messages:{
					url:{
						required:"请输入转人工地址！"
					}
				},
				submitHandler: editWW
			});
		});

		var selectSourceFlag = true;
    var bigList = [];
		function listPage(pageNo){
			//不勾选全选
			$('.select_rows').iCheck('uncheck');
			if(!pageNo)pageNo=1;
			$('#visiterList').tableAjaxLoader2(8);
			$.ajax({
				type:'get',
				datatype:'json',
				cache:false,//不从缓存中去数据
				url:encodeURI('../../TurnPeopleConfig/list?pageSize='+20+'&pageNo='+pageNo),
				success:
				function(data){
					if(data.status==0){
						if(data.list.length>0){
							var html = '';
              bigList = data.list;
							for(var i=0;i<data.list.length;i++){
								html += '<tr id="list-tr-'+data.list[i].Id+'">';
								html += '<td><input type="checkbox" name="ckb" class="select_row" value="'+data.list[i].Id+'" /></td>';
								html += '<td>'+convertk(jl2, data.list[i].Key)+'</td>';
								html += '<td>'+data.list[i].Url+'</td>';
								html += '<td>'+convertj(jl1, data.list[i].MsgType)+'</td>';
								html += '<td>'+(data.list[i].AddTime||'')+'</td>';
								html += '<td><a href="javascript:;" class="edit" title="编辑" style="cursor:pointer"><i class="glyphicon glyphicon-pencil"></i></a>&nbsp;&nbsp;<a class="handPutIn del_a" href="javascript:void(0);" rel="'+data.list[i].Id+'" title="删除" ><i class="glyphicon glyphicon-trash"></i></a></td>';
								html += '</tr>';
							}
							$('#visiterList').find('tbody').html(html);
							$('.del_a').on('click',function(){
								delById(this,'../../TurnPeopleConfig/delete',listPage,'VpageList');
							});
              $('.edit').on('click',function(){
                $('#editModal').modal('show');
                var i = $(this).parent().parent().index();
                $('#editForm [name=id]').val(bigList[i].Id);
                $('#editForm [name=key]').val(bigList[i].Key);
                $('#editForm [name=url]').val(bigList[i].Url);
                $('#editForm [name=msgType]').val(bigList[i].MsgType);
              });
							//列表ickeck初始化
							icheckListInit();
							//下面开始处理分页
							var options = {
								data: [data, 'list', 'total'],
								currentPage: data.currentPage,
								totalPages: data.totlePages,
								onPageClicked: function (event, originalEvent, type, page) {
									listPage(page);
								}
							};
							setPage('VpageList',options);
						}else{
							$('.select_rows').iCheck('uncheck');
							$('#visiterList').find('tbody').html('<tr><td colspan="8" style="text-align:center;"><i class="glyphicon glyphicon-warning-sign"></i>  当前纪录为空！</td></tr>');
							$('#VpageList').html('');
						}
					}else{
						yunNoty(data);
					}
				}
			})
		}

		var flag_ww_add=false;
		function addWW(){
			if(flag_ww_add){
				return;
			}
			flag_ww_add=true;
			$.ajax({
				type:'post',
				datatype:'json',
				cache:false,//不从缓存中去数据
				url:encodeURI('../../TurnPeopleConfig/create'),
				data:$("#addForm").serialize(),
				success:
				function(data){
					flag_ww_add=false;
					if(data.status===0){
						yunNoty(data);
						$('#addModal').modal('hide');
						listCurrentPage(listPage,'VpageList');
					}else{
						yunNoty(data);
					}
				}
			});
		}
		var flag_ww_edit=false;
		function editWW(){
			if(flag_ww_edit){
				return;
			}
			flag_ww_edit=true;
			$.ajax({
				type:'post',
				datatype:'json',
				cache:false,//不从缓存中去数据
				url:encodeURI('../../TurnPeopleConfig/update'),
				data:$("#editForm").serialize(),
				success:
				function(data){
					flag_ww_edit=false;
					if(data.status===0){
						yunNoty(data);
						$('#editModal').modal('hide');
						listCurrentPage(listPage,'VpageList');
					}else{
						yunNoty(data);
					}
				}
			});
		}
    function convertj(arr, key){
      var rtn = '';
      arr.forEach(function(el){
        if(el.IntValue == key) {
          rtn = el.CodeDesc;
        }
      });
      return rtn;
    }
    function convertk(arr, key){
      var rtn = '';
      arr.forEach(function(el){
        if(el.Key == key) {
          rtn = el.KeyDesc;
        }
      });
      return rtn;
    }
	</script>
</body>
</html>
