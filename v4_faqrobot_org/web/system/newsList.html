<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta charset="utf-8" />
	<title>新闻列表</title>
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
	<meta content="" name="description" />
	<meta content="" name="author" />

	<!-- ================== BEGIN BASE CSS STYLE ================== -->
	<link href="../../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
	<link href="../../assets/css/animate.min.css" rel="stylesheet" />
	<link href="../../assets/css/style.min.css" rel="stylesheet" />
	<link href="../../assets/css/style-responsive.min.css" rel="stylesheet" />
	<link href="../../assets/css/theme/default.css" rel="stylesheet" id="theme" />
	<link href="../../assets/plugins/jquery-ui/themes/base/minified/jquery-ui.min.css" rel="stylesheet" />
	<link href="../../assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
	<link href="../../assets/plugins/gritter/css/jquery.gritter.css" rel="stylesheet" />
	<link href="../../assets/plugins/bootstrap-datetimepicker/css/datetimepicker.css" rel="stylesheet" />
	<link href="../common/css/zTreeStyleTest.css" rel="stylesheet">
	<!-- ================== END BASE CSS STYLE ================== -->

	<link href="../common/css/radioskin/blue.css" rel="stylesheet">
	<link href="../common/css/commonCSS.css" rel="stylesheet">
</head>

<body class="pace-done">
	<div class="fade in hide" id="page-loader"><span class="spinner"></span></div>
	<div id="page-container" class="fade in">
		<div id="content" class="content">
			<ol class="breadcrumb pull-right">
				<li><a href="javascript:;">首页</a></li>
				<li><a href="javascript:;">系统管理</a></li>
				<li class="active">新闻列表</li>
			</ol>
			<div class="row">
				<h1 class="page-header">新闻列表</h1>
				<div data-sortable-id="table-basic-1" class="panel panel-inverse">
					<div class="panel-body">
						<a data-toggle="modal" class="btn btn-primary" href="#addModal">
							<i class="glyphicon glyphicon-plus"></i>
							添加新闻
						</a>
						<table class="table" id="newsList">
							<thead>
								<tr>
									<th>标题</th>
									<th>概要</th>
									<th>是否发表 </th>
									<th>分类</th>
									<th width="70">操作</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<div id="pageList"></div>
					</div>
				</div>
			</div>
			<!--添加新闻模态框-->
			<div class="modal fade" style="display: none;" aria-hidden="true" id="addModal">
				<div class="modal-dialog" style="width:60%;">
					<div class="modal-content">
						<div class="modal-header">
							<button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
							<h4 class="modal-title">添加新闻列表</h4>
						</div>
						<div class="modal-body">
							<form method="POST" id="addNews" class="form-horizontal">
								<fieldset>
									<div class="form-group">
										<label class="col-md-2 control-label">标题<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<input type="text" placeholder="请输入标题" class="form-control" name="title">
										</div>
									</div>
									<div class="form-group">
										<label class="col-md-2 control-label">概要<span class="red">&nbsp;*</span></label>
										<div class="col-md-9" style="position:relative">
											<input type="text" placeholder="请输入概要" class="form-control" name="keyWords">
										</div>
									</div>
									<div class="form-group">
										<label class="col-md-2 control-label">分组信息<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<input type="text" placeholder="请输入分组信息" class="form-control" name="groupName" readonly="true" >
											<input type="hidden" name="groupId" value="">
											<div class="treeDivOfConfigure" id="classTree" style="border: 1px solid rgb(228, 228, 228);position:absolute;z-index:99;background-color:rgb(255, 255, 255);height:250px;display: none;width:100%;">
												<ul id="treeHide1" class="ztree" style="margin-top:0;"></ul>
											</div>
										</div>
									</div>
									<div class="form-group">
										<label class="col-md-2 control-label">分类</label>
										<div class="col-md-9">
											<label class="radio">
												<input type="radio" value="0" name="mode">
												新闻
											</label>
											<label class="radio">
												<input type="radio" checked="" value="1" name="mode">
												产品动态
											</label>
											<label class="radio">
												<input type="radio" value="2" name="mode">
												行业分析
											</label>
											<label class="radio">
												<input type="radio" value="3" name="mode">
												通知
											</label>
											<label class="radio a" style="display: none;">
												<input type="radio" value="4" name="mode">
												公告
											</label>
										</div>
									</div>
									<div class="form-group b" style="display: none;">
										<label class="col-md-2 control-label">开始时间</label>
										<div class="col-md-9">
											<input type="text" placeholder="请选择时间" class="form-control form_datetime" name="startTime" readonly>
										</div>
									</div>
									<div class="form-group c" style="display: none;">
										<label class="col-md-2 control-label">结束时间</label>
										<div class="col-md-9">
											<input type="text" placeholder="请选择时间" class="form-control form_datetime" name="endTime" readonly>
										</div>
									</div>
									<!--<div class="form-group" style='display:none;'>
										<label class="col-md-2 control-label">索引码<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<input type="text" placeholder="请输入索引码" class="form-control" name="cId" maxlength="10">
										</div>
									</div>-->
									<div class="form-group">
										<label class="col-md-2 control-label">是否发表</label>
										<div class="col-md-9">
											<label class="radio">
												<input type="radio" checked="" value="0" name="status">
												不发表	
											</label>
											<label class="radio">
												<input type="radio" value="1" name="status">
												发表
											</label>
										</div>
									</div>
									<div class="form-group">
										<label class="control-label col-md-2">内容<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<textarea type="text" placeholder="请输入内容" class="" name="content" id="cont"></textarea>
										</div>
									</div>
								</fieldset>
							</form>
						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-sm btn-primary" href="javascript:;" onclick="$('#addNews').submit()">添加</button>
							<a data-dismiss="modal" class="btn btn-sm btn-white" href="javascript:;">取消</a>
						</div>
					</div>
				</div>
			</div>
			<!--修改新闻模态框-->
			<div class="modal fade" style="display: none;" aria-hidden="true" id="ediModal">
				<div class="modal-dialog" style="width:60%;">
					<div class="modal-content">
						<div class="modal-header">
							<button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
							<h4 class="modal-title">修改新闻</h4>
						</div>
						<div class="modal-body">
							<form method="POST" id="ediNews" class="form-horizontal">
								<fieldset>
									<div class="form-group">
										<label class="col-md-2 control-label">标题<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<input type="text" placeholder="请输入标题" class="form-control" name="title">
										</div>
									</div>
									<div class="form-group">
										<label class="col-md-2 control-label">概要<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<input type="text" placeholder="请输入概要" class="form-control" name="keyWords">
										</div>
									</div>
									<div class="form-group">
										<label class="col-md-2 control-label">分组信息<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<input type="text" placeholder="请输入分组信息" class="form-control" name="groupName" readonly="true">
											<input type="hidden" name="groupId" value="">
											<div class="treeDivOfConfigure" id="classTree" style="border: 1px solid rgb(228, 228, 228);position:absolute;z-index:99;background-color:rgb(255, 255, 255);height:250px;display: none;width:100%;">
												<ul id="treeHide2" class="ztree" style="margin-top:0;"></ul>
											</div>
										</div>
									</div>
									<div class="form-group">
										<label class="col-md-2 control-label">分类</label>
										<div class="col-md-9 news">
											<label class="radio">
												<input type="radio" value="0" name="mode">
												新闻
											</label>
											<label class="radio">
												<input type="radio" checked="" value="1" name="mode">
												产品动态
											</label>
											<label class="radio">
												<input type="radio" value="2" name="mode">
												行业分析
											</label>
											<label class="radio">
												<input type="radio" value="3" name="mode">
												通知
											</label>
											<label class="radio a" style="display: none;">
												<input type="radio" value="4" name="mode">
												公告
											</label>
										</div>
									</div>
									<div class="form-group b" style="display: none;">
										<input type="hidden" name="id"/>
										<label class="col-md-2 control-label">开始时间</label>
										<div class="col-md-9">
											<input type="text" placeholder="请选择时间" class="form-control form_datetime" name="startTime" readonly>
										</div>
									</div>
									<div class="form-group c" style="display: none;">
										<label class="col-md-2 control-label">结束时间</label>
										<div class="col-md-9">
											<input type="text" placeholder="请选择时间" class="form-control form_datetime" name="endTime" readonly>
										</div>
                                    </div>
                                    
									<div class="form-group" style="display:none;">
										<label class="col-md-2 control-label">索引码<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<input type="text" placeholder="请输入索引码" class="form-control" name="cId" maxlength="10">
										</div>
									</div>
									<div class="form-group">
										<label class="col-md-2 control-label">是否发表</label>
										<div class="col-md-9 status">
											<label class="radio">
												<input type="radio" checked="" value="0" name="status">
												不发表
											</label>
											<label class="radio">
												<input type="radio" value="1" name="status">
												发表
											</label>
										</div>
									</div>
									<div class="form-group">
										<label class="control-label col-md-2">内容<span class="red">&nbsp;*</span></label>
										<div class="col-md-9">
											<textarea type="text" placeholder="请输入内容" class="" name="content" id="contAfter"></textarea>
										</div>
									</div>
								</fieldset>
							</form>
						</div>
						<div class="modal-footer">
							<button type="submit" class="btn btn-sm btn-primary" href="javascript:;" onclick="$('#ediNews').submit()">确认修改</button>
							<a data-dismiss="modal" class="btn btn-sm btn-white" href="javascript:;">取消</a>
						</div>
					</div>
				</div>
			</div>



		</div>
		<a data-click="scroll-top" class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" href="javascript:;"><i class="fa fa-angle-up"></i></a>
	</div>
    <!-- ================== BEGIN BASE JS ================== -->
	<script src="../../assets/plugins/jquery/jquery-1.9.1.min.js"></script>
	<script src="../../assets/plugins/jquery/jquery-migrate-1.1.0.min.js"></script>
	<script src="../../assets/plugins/jquery-ui/ui/minified/jquery-ui.min.js"></script>
	<script src="../../assets/plugins/bootstrap/js/bootstrap.min.js"></script>
	<script src="../../assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script src="../../assets/plugins/gritter/js/jquery.gritter.js"></script>
	<script src="../../assets/js/apps.min.js"></script>
	<script src="../common/js/jquery.ztree.all-3.5.js"></script>
	<!--[if lt IE 9]>
		<script src="../../assets/crossbrowserjs/html5shiv.js"></script>
		<script src="../../assets/crossbrowserjs/respond.min.js"></script>
		<script src="../../assets/crossbrowserjs/excanvas.min.js"></script>
	<![endif]-->
	<!-- ================== END BASE JS ================== -->
	<script src="../../assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
	<script src="../common/js/bootstrap-datetimepicker.zh-CN.js"></script>
	<script src="../common/js/bootstrap-paginator.js"></script>
	<script src="../common/js/jquery.validate.js"></script>
	<script src="../common/js/icheck.js"></script>
	<script src="../common/js/customMethod.js"></script>
	<script type="text/javascript" src="../common/js/ueditor/ueditor.config.js"></script>
	<script type="text/javascript" src="../common/js/ueditor/ueditor.all.min.js"></script>
	<script type="text/javascript" src="../common/js/ueditor/lang/zh-cn/zh-cn.js"></script>
	<script src="js/system.js"></script>
	<script type="text/javascript">
		var sys = false;
		$(document).ready(function() {
			App.init();
			//列出表格
		$.ajax({
			type: 'post',
			datatype: 'json',
			cache: false,
			//不从缓存中去数据
			url: encodeURI('../../user/getLoginUser'),
			//data:encodeURI(tempcontent),
			success: function(data) {
				if(data.webConfig) {
					if(data.webConfig.Id == -100) {// sys
						$('.a').show().find('input').iCheck('check');
						$('.a').siblings().hide();
						sys = true;
					}else {
						$('.a').hide();
					}
					listNewsPage(1);
				}
			}
		});
			UE.getEditor('cont', {
				toolbars: [
					['fullscreen', 'source', '|', 'undo', 'redo', '|',
					'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor',
					'selectall', 'cleardoc', '|',
					 'fontfamily', 'fontsize', '|',
					'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'touppercase', 'tolowercase', '|',
					'link', 'unlink',
					 '|', 'imagenone', 
					'simpleupload', 'insertimage', 'emotion', 
					'insertvideo', 
					'music','attachment', 'map', 
					 'insertframe', 
					'horizontal',
					'date', 'time','wordimage'] 
				],
				initialFrameHeight: 120
			});
			UE.getEditor('contAfter', {
				toolbars: [
					['fullscreen', 'source', '|', 'undo', 'redo', '|',
						'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor',
						'selectall', 'cleardoc', '|',
						'fontfamily', 'fontsize', '|',
						'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'touppercase', 'tolowercase', '|',
						'link', 'unlink',
						'|', 'imagenone',
						'simpleupload', 'insertimage', 'emotion',
						'insertvideo',
						'music','attachment', 'map',
						'insertframe',
						'horizontal',
						'date', 'time','wordimage']
				],
				initialFrameHeight: 120
			});
			$('#addNews').validate({
				rules:{
					title:{
						required:true
					},
					keyWords:{
						required:true
					},
					content:{
						minlength:20,
						maxlength:500
					}
				},
				messages:{
					title:{
						required:"请输入新闻的标题！"
					},
					keyWords:{
						required:"请输入新闻的关键词！"
					},
					content:{
						minlength:"请输入不少于20个字符！",
						maxlength:"请输入不多于500个字符！"
					}
				},
				submitHandler: doNewAdd

			});
			//修改验证
			$('#ediNews').validate({
				rules:{
					title:{
						required:true
					},
					keyWords:{
						required:true
					},
					content:{
						minlength:20,
						maxlength:500
					}
				},
				messages:{
					title:{
						required:"请输入新闻的标题！"
					},
					keyWords:{
						required:"请输入新闻的关键词！"
					},
					content:{
						minlength:"请输入不少于20个字符！",
						maxlength:"请输入不多于500个字符！"
					}
				},
				submitHandler: doedit
			});
			//清空表单
			$('#addModal').on('hidden.bs.modal', function () {
				$('#addNews')[0].reset();
				$('#addNews input[name=mode]:eq(0)').iCheck('check');
				$('#addNews input[name=status]:eq(0)').iCheck('check');
				UE.getEditor('cont').setContent('');
			})
			$('#addModal').on('show.bs.modal', function () {
				$('#addNews')[0].reset();
				$('#addNews input[name=mode]:eq(0)').iCheck('check');
				$('#addNews input[name=status]:eq(0)').iCheck('check');
				UE.getEditor('cont').setContent('');
			})
		});

		var flag_add=false;
		function doNewAdd(){
			// 添加公告
			var str = '';
			if($('.a input').prop('checked')) {
				str = '?addWay=2'
			}
			if(flag_add){
				return;
			}
			flag_add=true;
			$.ajax({
				type: 'post',
				datatype: 'json',
				cache: false,
				//不从缓存中去数据
				url: encodeURI('../../news/doAdd'+ str),
				//data:encodeURI(tempcontent),
				data: $("#addNews").serialize(),
				success: function(data) {
					flag_add = false;
					if (data.status == 0) {
						yunNoty(data);
						$('#addModal').modal('hide');
						listCurrentPage(listNewsPage,'pageList');
					} else {
						yunNoty(data);
					}
				}
			});
		}
		function doedit(){
			// 添加公告
			var str = '';
			if($('.a input').prop('checked')) {
				str = '?addWay=2'
			}
			if(flag_add){
				return;
			}
			flag_add=true;
			$.ajax({
				type: 'post',
				datatype: 'json',
				cache: false,
				//不从缓存中去数据
				url: encodeURI('../../news/edit'+ str),
				//data:encodeURI(tempcontent),
				data: $("#ediNews").serialize(),
				success: function(data) {
					flag_add = false;
					if (data.status == 0) {
						yunNoty(data);
						$('#ediModal').modal('hide');
						listCurrentPage(listNewsPage,'pageList');
					} else {
						yunNoty(data);
					}
				}
			});
		}
		/* vcxiaohan begin */
		$(".form_datetime").datetimepicker({
			language: "zh-CN",
			format: "yyyy-mm-dd hh:ii",
			autoclose: true,
			todayBtn: true,
			minuteStep: 10,
			initialDate:new Date()
		});


		$('.a input').on('ifChanged', function() {
			if($(this).prop('checked')) {
				$('.b, .c').show();
			}else {
				$('.b, .c').hide();
			}
		});
		/* vcxiaohan end */
		var hidesetting = {
			view: {
				dblClickExpand: false,
				showIcon: false
			},
			data: {
				simpleData : {
				enable : true,
				idKey : "Id",
				pIdKey : "ParentId",
				rootPId : 0
				},
				key : {
					name : "Name"
				}
			},
			async : {
				enable : true,
				url : "../../classes/listClasses?m=0",
				autoParam : ["id"],
				dataFilter : ajaxDataFilter
			},
			callback: {
				onClick: function(event, treeId, treeNode, clickFlag){
					var treeObj = $.fn.zTree.getZTreeObj(treeId);
					Nodes = treeObj.getSelectedNodes();
					if($("#addModal").hasClass("in")){
						$("#addModal input[name=groupName]").val(Nodes[0].Name);
						$("#addModal input[name=groupId]").val(Nodes[0].Id);
					}else if($("#ediModal").hasClass("in")){
						$("#ediModal input[name=groupName]").val(Nodes[0].Name);
						$("#ediModal input[name=groupId]").val(Nodes[0].Id);
					}
					$(".treeDivOfConfigure").fadeOut("fast");
				},
			},
			
		}
		function ajaxDataFilter(treeId, parentNode, responseData) {
			if (responseData) {
				if (responseData.status == -1) {
					yunNoty(responseData);
				}
				responseData.list.push({
					Id: 0,
					ParentId: 0,
					Name: "全部分类",
					open: true
				});
				return responseData.list;
			}
			return responseData;
		}
		$("input[name=groupName]").on('click',function(){
			$(".treeDivOfConfigure").fadeIn("fast");
			$(".treeDivOfConfigure").css("width",$(this).css("width"))
			if($("#addModal").hasClass("in")){
				$.fn.zTree.init($("#treeHide1"),hidesetting,[]);
			}else if($("#ediModal").hasClass("in")){
				$.fn.zTree.init($("#treeHide2"),hidesetting,[]);
			}
		})

		$(window).resize(function(){
		 	$(".treeDivOfConfigure").css("width",$("input[name=groupName]").css("width"))
		});
		$("#addModal").on("hide.bs.modal",function(){
			$(".treeDivOfConfigure").fadeOut("fast");
			$("#addNews")[0].reset();
			$("input[name=cId]").removeClass("text-error helper-font-small").addClass("valid")
			$("input[name=cId]").next().css("display","none")
		})
		$("#ediModal").on("hide.bs.modal",function(){
			$(".treeDivOfConfigure").fadeOut("fast");
			$("input[name=cId]").removeClass("text-error helper-font-small").addClass("valid")
			$("input[name=cId]").next().css("display","none")
			$("#ediModal input[name=groupName]").val("");
			$("#ediModal input[name=groupId]").val("");
		})
	</script>
</body>
</html>
