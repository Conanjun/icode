<html>
    <head>
        <base href="/">
        <base href="null">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="format-detection" content="telephone=no">
        <title>小云</title>
        
        <link rel="stylesheet" type="text/css" href="/servlet/css/common.css">
        <!--[if lt IE 9]>
        <link rel="stylesheet" type="text/css" href="http://res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_pc22ebff.css">
        <![endif]-->
        <script src="/servlet/js/jquery/jquery-1.9.1.min.js"></script>
        <script src="/servlet/js/wechat/jweixin-1.0.0.js"></script>
    </head>
        <body id="activity-detail" class="zh_CN ">
            <div id="js_article" class="rich_media">
                <div class="rich_media_inner">
                    <h2 class="rich_media_title" id="activity-name">
                        jinjin
                        <div class="close-btn"><img src="http://v4.faqrobot.net/servlet/images/close.png" alt="关闭"></div>
                    </h2>
                    <div class="rich_media_meta_list">
                        <em id="post-date" class="rich_media_meta rich_media_meta_text">2017-12-01</em>
                        <em class="rich_media_meta rich_media_meta_text">1</em>
                        <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="javascript:void(0);" id="post-user">小云</a>
                    </div>
                    <div id="page-content">
                        <div id="img-content">
                            <div class="rich_media_thumb_wrp" id="media">
                                
                            </div>
                            <div class="rich_media_content" id="js_content"><p><img src='/upload/web/1508807900261839/20171201/64181512099655888.jpg' title='64181512099655888.jpg' alt='。。。.jpg'/></p></div>
                            <div class="rich_media_tool" id="js_toobar">
                                
                                <div id="js_read_area" class="media_tool_meta link_primary meta_primary" style="display:none;">阅读 <span id="readNum">0</span></div>
                                <a style="display:none;" class="media_tool_meta meta_primary link_primary meta_praise" href="javascript:void(0);" id="like">
                                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum"></span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </body>
    
        <script>
            var imgArray=[];//所有img链接的数组
            $(document).ready(function() {
                $('#page-content img').each(function(){
                    var mtPicUrl = "null";
                    //遍历所有img标签，获取src链接地址
                    if($(this).attr('src').indexOf('http')<0){
                        if (mtPicUrl != "null")
                        {
                            imgArray.push(mtPicUrl + "/" + $(this).attr('src'));
                        }else {
                            imgArray.push(window.location.protocol+'//'+window.location.host+$(this).attr('src'));
                        }
                    }else{
                        if (mtPicUrl != "null")
                        {
                            imgArray.push(mtPicUrl + "/" + $(this).attr('src').substr($(this).attr('src').indexOf('/upload') + 1));
                        }else {
                            imgArray.push($(this).attr('src'));
                        }
                    }
                })
                $('#page-content img').click(function(){
                    var tmpUrl='';
                    var mtPicUrl = "null";
                    if($(this).attr('src').indexOf('http')<0){
                        if (mtPicUrl != "null")
                        {
                            tmpUrl = mtPicUrl + "/" + $(this).attr('src');
                        }else {
                            tmpUrl = window.location.protocol + '//' + window.location.host + $(this).attr('src');
                        }
                    }else{
                        if (mtPicUrl != "null")
                        {
                            tmpUrl = mtPicUrl + "/" + $(this).attr('src').substr($(this).attr('src').indexOf('/upload') + 1);
                        }else {
                            tmpUrl = $(this).attr('src');
                        }
                    }
                    wx.previewImage({
                        current: tmpUrl, // 当前显示图片的http链接
                        urls: imgArray// 需要预览的图片http链接列表
                    });
                })
                // 关闭按钮
                $('body').on('touchstart',function(){
                    if(isPC()){
                        return;
                    }else{
                        $('.close-btn').show();
                    }
                })
                $('.close-btn').on('click',function(){
                    if(window.history.length>1){
                        window.history.go(-1);
                    }else{
                        window.close();
                    }
                })
            });
            /**
             * 判断手机/pc
             * 返回true 表示是PC
             * */
            function isPC () {
                var userAgentInfo = navigator.userAgent;
                var Agents = ['android', 'iphone', 'windows phone','ipad', 'ipod'];
                var flag = true;
                for (var v = 0; v < Agents.length; v++) {
                    if (userAgentInfo.toLowerCase().indexOf(Agents[v]) > 0) {
                        flag = false;
                        break
                    }
                }
                return flag
            }
        </script>
    </html>
    