!function($){$.fn.extend({faqrobot:function(sysNum,options){var isSysNum="number"==typeof sysNum;return options=$.extend({},$.FaqRobot.defaults,{sysNum:isSysNum?sysNum:1e4},options),this.each(function(){new $.FaqRobot(this,options)})}}),$.FaqRobot=function(input,options){function request(url,successed,failure,dataType,params){if("string"==typeof url&&url.length>0){var extraParams={timestamp:+new Date,dataType:dataType||options.dataType};extraParams=$.extend({},extraParams,params),$.each(options.extraParams,function(key,param){extraParams[key]="function"==typeof param?param():param}),$.ajax({dataType:options.dataType,url:encodeURI(url),data:extraParams,success:function(data){var parsed=options.parse&&options.parse(data)||parse(data);return parsed.status<0&&"function"==typeof failure?void failure(parsed):-1==parsed.status?void(options.showErrorMsg&&options.showErrorMsg(data)||showErrorMsg(parsed.message||"请求信息错误，请刷新！")):-2==parsed.status?void(options.showErrorMsg&&options.showErrorMsg(data)||showErrorMsg(parsed.message||"您的信息认证未通过，请重新认证！",options.authUrl)):(keepCount=0,getNewTime(parsed),"function"==typeof successed&&successed(parsed),void $("#"+options.chatContDiv).parent().scrollTop(1e5))},error:function(){options.showErrorMsg&&options.showErrorMsg(data)||showErrorMsg("数据请求错误，请刷新！")}})}}function showErrorMsg(msg,otherUrl,timeOut){showErrorDiv(msg,function(){otherUrl&&"string"==typeof otherUrl&&(location.href=otherUrl)})}function parse(data){return data}function initRobotBaseInfo(){-1!==window.location.href.indexOf("sysNum=")&&(options.sysNum=window.location.href.split("sysNum=")[1].replace("#","")),$input.attr("oldvalue",options.inputMagOldvalue),$input.val(options.inputMagOldvalue);var infoUrl=options.basePath+"AQ?s=p&sysNum="+options.sysNum+"&"+getjid[0];request(infoUrl,sayHello)}function getQueryString(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i"),r=window.location.search.substr(1).match(reg);return null!=r?r[2]:null}function sayHello(data){$input.focus();var fromurl=location.href;return urlId=fromurl.split("?"),-1==data.status?void showErrorDiv("网络有点不给力，请刷新页面尝试。"):-2==data.status?(showErrorDiv("您的信息认证未通过，请重新认证！"),void(location.href=data.loginurl)):("undefined"!=typeof data.webConfig.robotName&&(options.robotName=data.webConfig.robotName),"undefined"!=typeof data.webConfig.logoUrl&&(options.logoUrl=""==data.webConfig.logoUrl?"skin/zbj2/images/logo.png":data.webConfig.logoUrl,$("#"+options.logoDiv).attr("src",options.logoUrl)),$(document).attr("title",data.webConfig.webName),r_intQuesUrl(),init_leadQuestions(data),init_topQuestions(data.topAsk),init_newQuestions(data.newAdd),init_baseInfo(data),init_quickLink(data.quickLink),init_recommend(data.chatFormSugLink),$("#"+options.sendBtn).click(function(){sendeMsg()}),void $("#"+options.clearScreen).click(function(){var welcomP=$("<div/>").addClass("serv chat-ctn"),welcomCont=chatContDIv.find("div").first().html();chatContDIv.html(""),welcomP.html(welcomCont).appendTo(chatContDIv),setScroll()}))}function init_quickLink(quickLink){if(options.quickLink&&options.quickLink.length>2&&quickLink&&quickLink.length>0){for(var html=[],i=0;i<quickLink.length;i++)html.push('<li ><a href="'+quickLink[i].linkUrl+'" target="_blank"><img src="'+quickLink[i].imageUrl+'" ></a></li>');$("#"+options.quickLink+" ul").html(html.join(""))}}function init_recommend(recommendata){if(options.recommend&&options.recommend.length>2&&recommendata&&recommendata.length>0){var html=[];if(len=recommendata.length,$target=$("#"+options.recommend),$up=$target.parent(),$down=$target.find("dl"),0==recommendata[0].type)for(var i=0;30>i;i++){for(var j=0;len>j;j++){html.push('<dt><a href="'+recommendata[j].linkurl+'" target="_blank">'+recommendata[j].content+"</a></dt>");var a=260*len;$down.css({height:a})}$up.css({overflow:"hidden",position:"relative"}),$target.css({position:"relative",overflow:"hidden",height:"100%"}),$down.css({position:"absolute",top:"0",left:"0"}),wholeH=$(".fuzb2 dl").outerHeight()}else for(var i=0;len>i;i++)$up.css({overflow:"auto"}),html.push('<div><dt class="fkz"><a href="'+recommendata[i].linkurl+'" target="_blank"><img class="a" src="'+recommendata[i].content+' "></a></dt></div>');$("#"+options.recommend+" dl").html(html.join("")),$fkz=$(".fkz");var xTimer;$target.on("mouseout",function(){xTimer=setInterval(function(){$down.css({top:"-=.2px"}),parseInt($down.css("top"))<-wholeH/10&&$down.css({top:"0"})},10)}),$target.on("mouseover",function(){clearInterval(xTimer)}),xTimer=setInterval(function(){$down.css({top:"-=.2px"}),parseInt($down.css("top"))<-wholeH/10&&$down.css({top:"0"})},10)}}function setH(){var h=$up.height()-50;$fkz.height(h/len)}function init_leadQuestions(data){var allObj='<div class="serv chat-ctn"><span class="serv-icon"><img src="'+options.kfUrl+'" /></span><div class="serv-ctn wc-pre"><i class="triangle triangle1"></i><i class="triangle triangle2"></i><p class="say-word pre-say-word">'+data.webConfig.helloWord+"</p>",leaveHtml="";if(data.leaveQue&&data.leaveQue.length>1){leaveHtml='<div class="MN_leaveQueTop"><span>这里有您的留言，</span>请<span class="MN_lookLeaveQue">点击查看</span></div>';for(var i=0;i<data.leaveQue.length;i++)leaveHtml+='<div class="MN_leaveQueBottom"><div class="MN_leaveQueItem"><div class="">问题'+(1==data.leaveQue.length?"":i+1)+"："+data.leaveQue[i].question+'</div><div class="">答案：'+data.leaveQue[i].answer+"</div></div></div>"}allObj+=leaveHtml+'<span class="nameWrap"><span class="r2-name">'+options.robotName+'</span><i class="time">'+getTime()+"</i></div></div>",chatContDIv.html(allObj);var tempUrl=window.location.href;tempUrl=tempUrl.substring(tempUrl.indexOf("=")+1,tempUrl.length).split("&");var systest=new RegExp("sysNum");systest.test(tempUrl)||tempUrl[1]&&askQue(decodeURI(tempUrl[1].split("=")[1])),setScroll()}function init_topQuestions(orderList){options.topQuestionDiv&&options.topQuestionDiv.length>2&&"undefined"!=typeof orderList&&orderList.length>1&&formatQueULList(options.topQuestionDiv,orderList)}function init_newQuestions(orderList){options.newQuestionDiv&&options.newQuestionDiv.length>2&&"undefined"!=typeof orderList&&orderList.length>1&&formatQueULList(options.newQuestionDiv,orderList)}function init_baseInfo(data){var cardhtml2="<dl>";if(options.baseInfoDiv&&options.baseInfoDiv.length>2){if("undefined"!=typeof data.webConfig){var cardhtml2="<dl>";"undefined"!=typeof data.webConfig.webName&&(cardhtml2+="<dt>名称："+data.webConfig.webName+"</dt>"),"undefined"!=typeof data.webConfig.serviceTel&&(cardhtml2+="<dt>电话："+data.webConfig.serviceTel+"</dt>"),"undefined"!=typeof data.webConfig.webSite&&(cardhtml2+='<dt>网址：<a href="'+data.webConfig.webSite+'" target="_black">'+data.webConfig.webSite+"</a></dt>")}if(data.advList&&data.advList.length>0)for(var i=0;i<data.advList.length;i++){var style=data.advList[i].type;0==style?cardhtml2+="<dt>"+data.advList[i].name+"："+data.advList[i].value+"</dt>":1==style?cardhtml2+=0==data.advList[i].value.indexOf("<")&&data.advList[i].value.indexOf(">")>0?"<dt>"+data.advList[i].name+"："+data.advList[i].value:"<dt>"+data.advList[i].name+'：<a href="javascript:;" href="'+data.advList[i].value+'" target="_blank">'+data.advList[i].value+"</a></dt>":2==style?cardhtml2+=0==data.advList[i].value.indexOf("<")&&data.advList[i].value.indexOf(">")>0?"<dt>"+data.advList[i].name+"："+data.advList[i].value:"<dt>"+data.advList[i].name+'：<br><img src="'+data.advList[i].value+'">':3==style&&(cardhtml2+=0==data.advList[i].value.indexOf("<")&&data.advList[i].value.indexOf(">")>0?"<dt>"+data.advList[i].name+"："+data.advList[i].value:"<dt>"+data.advList[i].name+'：<a href="http://wpa.qq.com/msgrd?v=3&uin='+data.advList[i].value+'&site=qq&menu=yes" target="_blank"><img alt="'+data.advList[i].name+'" src="images/Service1.png"></a>')}}cardhtml2+="</dl>",$("#"+options.baseInfoDiv).html(cardhtml2)}function init_advInfo(data){if(options.advInfoDiv&&options.advInfoDiv.length>2&&"undefined"!=typeof data.webConfig&&data.webConfig.length>1){var cardhtml2="<table>";if("undefined"!=typeof data.webConfig.serviceQq&&(cardhtml2+='<tr><td>Q Q：</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+data.webConfig.serviceQq+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+data.webConfig.serviceQq+':51" alt="QQ在线客服" title="QQ在线客服"/></a></td></tr>'),"undefined"!=typeof data.advs){var lists=data.advs;for(i=0;i<lists.length;i++){var name=$.trim(lists[i].name),value=$.trim(lists[i].value),type=lists[i].type;0==type?cardhtml2+="<tr><td>"+name+"：</td><td>"+value+"</td></tr>":1==type?cardhtml2+="<tr><td>"+name+"：</td><td>"+value+"</td></tr>":2==type?cardhtml2+="<tr><td>"+name+"：</td><td>"+value+"</td></tr>":3==type&&(cardhtml2+="<tr><td>"+name+'：</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+value+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+value+':51" alt="'+name+'" title="'+name+'"/></a></td></tr>')}}cardhtml2+="</table>",$("#"+options.advInfoDiv).html(cardhtml2)}}function setInerHtml(targetId,htm){targetId&&targetId.length>2&&htm&&htm.length>0&&$("#"+targetId).html(htm)}function formatQueULList(targetId,list,ulclass,maxCount,maxWords){if(!list)return"";$("#"+targetId).empty();for(var element=$("<dl/>").appendTo($("#"+targetId)),max=limitNumberOfItems(list.length),i=0;max>i;i++)if(list[i]){var lielement=$("<dt/>").html(i+1+"."),formattedCont=options.formatBaseQueCount&&options.formatBaseQueCount(list[i],i+1,max,options.queConMaxWordsCount)||formatBaseQueCount(list[i],i+1,max);if(formattedCont!==!1){var childElement=$("<a/>");childElement.html(formattedCont).appendTo(lielement).attr("href","javascript:void(0)").attr("title",list[i].question).attr("aid",list[i].solutionId).click(function(){return $this=$(this),askQue($this.attr("title"),$this.attr("aid")),!1}),lielement.appendTo(element)}}}function limitstr(chinese_string,maxcount){if(!maxcount)return chinese_string;if(chinese_string.length>maxcount){var new_text=chinese_string.substring(0,maxcount)+"...";return new_text}return chinese_string}function formatBaseQueCount(row,i,max){return limitstr(row.question)}function limitNumberOfItems(available){return options.maxTopQuestions&&options.maxTopQuestions<available?options.maxTopQuestions:available}function showErrorDiv(msg,fun){showerrorDiv.html(msg),showerrorDiv.delay(1e3).fadeTo("slow",.2).fadeTo("slow",1).fadeOut(2e3,function(){showerrorDiv.html(""),"function"==typeof fun&&fun()}).stop()}function sendeMsg(){var s_msg="";s_msg=$input.val(),s_msg=$xss(s_msg,"html"),""!=s_msg&&s_msg!=options.inputMagOldvalue&&($input.val(""),$(".ac_results").hide(),1==s_msg.length&&s_msg>0&&"undefined"!=typeof nu[s_msg-1]&&(s_msg=nu[s_msg-1],nu=[]),askQue(s_msg),$("#"+options.wordremain).html(100),$input.focus())}function askQue(msg,slutionId){if(msg&&msg.length>0){var askUrl=options.basePath+"AQ?s=aq";slutionId&&slutionId++>0&&(askUrl+="&sId="+slutionId+"&sysNum="+options.sysNum),showMyWordsToForm(msg),request(askUrl,showRobotWordsToForm,0,options.dataType,{question:msg})}}function showMyWordsToForm(msg){if(msg||0!=msg.length){var formattedCont=options.showMyWords&&options.showMyWords(msg,getTime())||createMyWordsHtml(msg,getTime());chatContDIv.append(formattedCont),setScroll()}}function createMyWordsHtml(msg,time){var myword='<div class="customer chat-ctn"><span class="serv-icon"><img src="'+options.khUrl+'" /></span><div class="serv-ctn"><i class="triangle triangle1"></i><i class="triangle triangle2"></i><p class="say-word">'+msg+'</p><i class="time">我&nbsp;&nbsp;'+time+'</i></div> </div><div class="cl"></div>';return myword}function showRobotWordsToForm(data){if(data||0!=data.length){var formattedCont=options.showRobotWords&&options.showRobotWords(data,getTime())||createRobotWordsHtml(data,getTime());chatContDIv.append(formattedCont),setScroll()}}function createRobotWordsHtml(data,time){if("undefined"==typeof data.robotAnswer||0==data.robotAnswer.length)return"";for(var allItems,ansItemObj,i=0;i<data.robotAnswer.length;i++){ansItemObj=data.robotAnswer[i];var tmp=createRobotWordsHtmlItem(ansItemObj,time);allItems?allItems.after(tmp):allItems=tmp}return allItems}function createRobotWordsHtmlItem(ansItem,time){var beforeWords="",afterWords="";if("undefined"!=typeof ansItem.gusWords&&null!=ansItem.gusWords?(beforeWords=""==ansItem.gusWords.ydWords?"您是不是要咨询下面的问题？":ansItem.gusWords.ydWords,afterWords=""==ansItem.gusWords.afterWords?"":ansItem.gusWords.afterWords):(beforeWords="您是不是要咨询下面的问题？",afterWords=""),!ansItem)return"";var allObj=$("<div/>").addClass("serv chat-ctn"),all_logo=$("<span/>").addClass("serv-icon").appendTo(allObj),all_con=($("<img />").attr({src:options.kfUrl}).appendTo(all_logo),$("<div/>").addClass("serv-ctn").appendTo(allObj)),all_robot_chat=($("<i>").addClass("triangle triangle1").appendTo(all_con),$("<i>").addClass("triangle triangle2").appendTo(all_con),$("<div/>").appendTo(all_con)),all_nameWrap=$('<span class="nameWrap"></span>').appendTo(all_robot_chat);all_nameWrap.append('<span class="r-name">'+options.robotName+"</span>");var all_robot_info=$("<p/>").addClass("say-word").appendTo(all_robot_chat);all_nameWrap.append('<i class="time">'+getTime()+"</i>");var all_if_use=$("<div/>").addClass("ishaveyong").appendTo(all_con);if(allObj.after('<p class="spacing15"></p>'),"undefined"!=typeof ansItem.aId&&0!=ansItem.aId){var aid=ansItem.aId,cluid=ansItem.cluid,helpDiv=$("<div/>").addClass("helper_aid_"+aid).appendTo(all_if_use).html('<span style="color:#999; font-size:12px;">以上内容对您有帮助吗？</span>');$("<a/>").addClass("robot_review_yes").attr("helptag",1).attr("aid",aid).attr("uid",cluid).click(helpclick).html("<span></span>满意").appendTo(helpDiv),$("<a/>").addClass("robot_review_no").attr("helptag",0).attr("aid",aid).attr("uid",cluid).click(helpclick).html("<code></code>不满意").appendTo(helpDiv)}if("undefined"!=typeof ansItem.aId&&0!=ansItem.aId&&options.sugQuestionDiv&&options.sugQuestionDiv.length>2&&"undefined"!=typeof ansItem.relateLessList&&ansItem.relateLessList.length>1){var rightCon_relate=$("<div/>").addClass("relateTxt").appendTo(all_robot_info),relatelist=ansItem.relateLessList;if(!relatelist)return"";for(var element=$("<dl/>").appendTo(rightCon_relate),lielement=$("<dt/>").html("你是否还想问如下问题：").appendTo(element).css("color","red"),max=limitNumberOfItems(relatelist.length),i=0;max>i;i++)if(relatelist[i]){var formattedCont=options.formatBaseQueCount&&options.formatBaseQueCount(relatelist[i],i+1,max,options.queConMaxWordsCount)||formatBaseQueCount(relatelist[i],i+1,max);if(formattedCont!==!1){var ddElement=$("<dd/>").appendTo(element).html(i+1+".&nbsp;"),childElement=$("<a/>");childElement.html(formattedCont).appendTo(ddElement).attr("href","javascript:void(0)").attr("title",relatelist[i].question).attr("aid",relatelist[i].solutionId).click(function(){return $this=$(this),askQue($this.attr("title"),$this.attr("aid")),!1}),nu[i]=relatelist[i].question}}rightCon_relate.after($("<div/>").addClass("clear"))}if(""!=ansItem.ansCon&&ansItem.ansCon.length>0){all_robot_info.html(ansItem.ansCon)}if(ansItem.relateList.length>0){var lielement=$("<dl/>").append("<dt>"+beforeWords+"</dt>").appendTo(all_robot_info),answerlist=ansItem.relateList;for(i=0;i<answerlist.length;i++){var title=$.trim(answerlist[i].question),aid=answerlist[i].solutionId,ddElement=$("<dd/>").appendTo(lielement).html(i+1+".&nbsp;"),childElement=$("<a/>");childElement.html(title).appendTo(ddElement).attr("href","javascript:void(0)").attr("title",title).attr("aid",answerlist[i].solutionId).click(function(){return $this=$(this),askQue($this.attr("title"),$this.attr("aid")),!1}),nu[i]=title}return $("<dt/>").html(afterWords).appendTo(lielement),allObj}if(ansItem.gusList.length>0){var lielement=$("<dl/>").append("<dt>"+beforeWords+"</dt>").appendTo(all_robot_info),answerlist=ansItem.gusList;for(i=0;i<answerlist.length;i++){var title=$.trim(answerlist[i].seedQuestion.question),aid=answerlist[i].solutionId,ddElement=$("<dd/>").appendTo(lielement).html(i+1+".&nbsp;"),childElement=$("<a/>");childElement.html(title).appendTo(ddElement).attr("href","javascript:void(0)").attr("title",title).attr("aid",answerlist[i].solutionId).click(function(){return $this=$(this),askQue($this.attr("title"),$this.attr("aid")),!1}),nu[i]=title}return $("<dt/>").html(afterWords).appendTo(lielement),allObj}if(""==ansItem.ansCon){var answer=ansItem;return"undefined"!=typeof answer.sq&&(answer='关于问题&nbsp;&nbsp;"<b>'+answer.sq+'</b>"&nbsp;的回复：</br>'+answer),all_robot_info.html("&nbsp;"),allObj}return all_robot_info.html(replaceFace(ansItem.ansCon)),allObj}function replaceFace(data){var src="src/",face={"云问表情":[["微笑","/::)"],["色","/::B"],["得意","/:8-)"],["流泪","/::<"],["害羞","/::$"],["闭嘴","/::X"],["发怒","/::@"],["呲牙","/::D"],["惊讶","/::O"],["难过","/::("],["酷","/::+"],["愉快","/:,@-D"],["流汗","/::L"],["奋斗","/:,@f"],["疑问","/:?"],["晕","/:,@@"],["委屈","/:P-("]]};for(var i in face)switch(i){case"云问表情":src="src/yun/";for(var j=0;j<face[i].length;j++)for(;data.indexOf(face[i][j][1])+1;){var index=data.indexOf(face[i][j][1]),len=face[i][j][1].length,str1=data.substr(0,index),str2=data.substr(index+len);data=str1+'<img src="'+src+j+'.png">'+str2}}return data}function offLine(){var s_q_url=options.basePath+"AQ?s=offline&nocache="+(new Date).getTime();$.getJSON(s_q_url,function(data){if(0==data.status){var obj=eval('({"robotAnswer":{"ansCon":"您已下线，感谢您的使用！如果需要再次聊天，请重新打开或刷新本页面！","status":0,"tspan":2}})');showRobotWordsToForm(obj)}})}function keepAlive(){if("undefined"!=typeof dt&&clearTimeout(dt),s_tspan<100&&keepCount<240){keepCount++;var s_time=1e3*s_tspan;dt=setTimeout(autoRequest,s_time)}else offLine()}function getNewTime(data){"undefined"!=typeof data.tspan&&(s_tspan!=data.tspan&&(s_tspan=data.tspan),keepAlive())}function autoRequest(){var s_tempmeg=$.trim($input.text()),autoR_url=options.basePath+"AQ?s=kl";$.ajax({type:"post",datatype:"json",cache:!1,url:options.basePath+"AQ?s=kl",data:"question="+encodeURI(s_tempmeg),success:function(data){if(0==data.status)getNewTime(data),data.robotAnswer&&data.robotAnswer.length>0&&showRobotWordsToForm(data);else{var obj=eval('({"robotAnswer":{"ansCon":"您已下线，感谢您的使用！如果需要再次聊天，请重新打开或刷新本页面！","status":0,"tspan":2}})');showRobotWordsToForm(obj)}}})}function word_clu(obj){var lenE=obj.value.length,lenC=0,CJK=obj.value.match(/[\u4E00-\u9FA5\uF900-\uFA2D]/g);null!=CJK&&(lenC+=CJK.length);var inputMax=$(obj).attr("maxLength"),remainword=inputMax-lenC-lenE;if(0>=remainword){for(var tmp=0,cut=obj.value.substring(0,obj.maxLength),i=0;i<cut.length&&(tmp+=/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(cut.charAt(i))?2:1,!(tmp>obj.maxLength));i++);return obj.value=cut.substring(0,i),$("#"+options.wordremain).html(0),!1}$("#"+options.wordremain).html(remainword)}function helpclick(){$this=$(this);var aid=$this.attr("aid"),uid=$this.attr("uid"),usefull=$this.attr("helptag");$(".helper_aid_"+aid).text("感谢您的评价!").css("color","#bbb");var s_q_url="";s_q_url=1==usefull?options.basePath+"AQ?s=addufc&aId="+aid+"&cluid="+uid+"&sysNum="+options.sysNum:options.basePath+"AQ?s=addulc&aId="+aid+"&cluid="+uid+"&sysNum="+options.sysNum,request(s_q_url)}function removeHTMLTag(str){return str?(str=str.replace(/<\/?[^>]*>/g,""),str=str.replace(/[ | ]*\n/g,"\n"),str=str.replace(/\n[\s| | ]*\r/g,"\n"),str=str.replace(/&nbsp;/gi,""),str=str.replace(/(^\s*)|(\s*$)/g,""),str=str.replace(/[\r\n]/g,"")):""}function fadeback(obj){$this=$(obj);var fadeform=$this.parents("form"),fadeUrl=options.basePath+"AQ?s=fadeback&sysNum="+options.sysNum+"&sub=nothing",val2="";fadeform.find("input[name=sub]").val(val2),$.ajax({type:"get",datatype:"json",cache:!1,url:encodeURI(fadeUrl),data:fadeform.serialize(),success:function(data){showErrorDiv(data.message),$this.parents("form").find("textarea").val("")}})}function Evaluation(){$(".feedback").length>0?OAnswer.push('<div class="msgleft"><p class="i"><img width="50" src="skin/chat55/images/fi1.png"></p><div class="msgcontent"><p class="spacing"></p><div class="kftext"><div><span class="s1">'+options.robotName+'</span>：<p>您已经做过评价了！</p><span class="s2">'+getTime()+'</span></div><p class="spacing5"></p><div class="ishaveyong"><p class="spacing5"></p><span></span></div></div><p class="spacing"></p></div></div><p class="spacing15"></p>'):(OAnswer.push('<div class="msgleft satisfied">'),OAnswer.push('<p class="kissub"></p>'),OAnswer.push('<p class="i"><img src="skin/chat55/images/fi1.png" width="50" /></p>'),OAnswer.push('<div class="msgcontent" style="width:368px;">'),OAnswer.push('<p class="spacing"></p>'),OAnswer.push('<div class="kftext">'),OAnswer.push('<span class="s1">'+options.robotName+"：满意度评价</span>"),OAnswer.push('<p class="spacing"></p>'),OAnswer.push('<div  class="feedback">'),OAnswer.push('<form id="user_form" method="post" >'),OAnswer.push('<div class="fdbtitle">您对刚才的服务沟通满意度如何？</div>'),OAnswer.push('<div class="fdbselect" id="va1"><label><input name="level" type="radio" value="1" checked="checked" class="rdoGood" />送鲜花&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label><label><input name="level" type="radio" value="0" class="rdoBad" />拍板砖&nbsp;&nbsp;</label></div>'),OAnswer.push('<p class="spacing"></p>'),OAnswer.push('<div class="notManyi" style="display:none;"><div class="fdbtitle">你不满意的原因：</div>'),OAnswer.push('<div class="fdbselect" id="va2"><label><input name="reason[]" type="checkbox" value="回答不准确"/>回答不准确&nbsp;&nbsp;</label><label><input name="reason[]" type="checkbox" value="答非所问" />答非所问&nbsp;&nbsp;</label><label><input name="reason[]" type="checkbox" value="机器人骂人" />机器人骂人&nbsp;&nbsp;</label></div>'),OAnswer.push('<p class="spacing"></p>'),OAnswer.push('<div class="fdbtitle">为了更好的为您服务，请输入您的宝贵意见！</div>'),OAnswer.push('<p class="spacing5"></p>'),OAnswer.push('<div class="fdbtextarw"><textarea name="content" class="fdbvtexta" onfocus=if(this.value=="描述你的意见和建议，以便我们提升服务水平和质量，谢谢你！"){this.value=""} onblur=if(this.value==""){this.value="描述你的意见和建议，以便我们提升服务水平和质量，谢谢你！"}>描述你的意见和建议，以便我们提升服务水平和质量，谢谢你！</textarea></div></div>'),OAnswer.push('<div class="xrvdobtn">'),OAnswer.push('<input type="hidden" name="sub">'),OAnswer.push('<input id="fadeBackId" type="button" value="提交" class="xsrvbtn1"/>'),OAnswer.push("</div>"),OAnswer.push("</form>"),OAnswer.push("</div>"),OAnswer.push('<p class="spacing"></p>'),OAnswer.push("</div>"),OAnswer.push('<p class="spacing"></p>'),OAnswer.push("</div>"),OAnswer.push("</div>"),OAnswer.push('<p class="spacing15"></p>'))}function satisfactionEvaluation(){showMes("我:&nbsp;","满意度评价"),OAnswer=[],Evaluation(),$(".vtddcntin").append($(OAnswer.join("")))}function speak(){OAnswer.push('<div class="msgleft body">'),OAnswer.push('<p class="kissub"></p>'),OAnswer.push('<p class="i"><img src="skin/chat55/images/fi1.png" width="50" /></p>'),OAnswer.push('<div class="msgcontent">'),OAnswer.push('<p class="spacing"></p>'),OAnswer.push('<div class="kftext">'),OAnswer.push('<span class="s1">'+options.robotName+"：教我说话</span>"),OAnswer.push('<p class="spacing"></p>'),OAnswer.push('<div class="feedback">'),OAnswer.push('<form id="user_form" method="post" >'),OAnswer.push('<div class="fdbtitle">描述您的问题</div>'),OAnswer.push('<div class="fdbtextarw"><textarea id="va1" name="va1" cols="" rows="" class="fdbvtexta" onfocus="if(this.value==\'问题：the answer to life, the universe, and everything\'){this.value=\'\'};" onblur="if(this.value==\'\'){this.value=\'问题：the answer to life, the universe, and everything\'}">问题：the answer to life, the universe, and everything</textarea></div>'),OAnswer.push('<p class="spacing"></p>'),OAnswer.push('<div class="fdbtitle">描述您的答案</div>'),OAnswer.push('<p class="spacing5"></p>'),OAnswer.push('<div class="fdbtextarw"><textarea name="va4" id="va2" cols="" rows="" class="fdbvtexta" onfocus=if(this.value=="答案：42"){this.value=""} onblur=if(this.value==""){this.value="答案：42"}>答案：42</textarea></div>'),OAnswer.push('<p id="suggues"></p>'),OAnswer.push('<p class="spacing"></p>'),OAnswer.push('<div class="xrvdobtn">'),OAnswer.push('<input type="button" value="提交" class="xsrvbtn1"/>'),OAnswer.push("</div>"),OAnswer.push("</form>"),OAnswer.push("</div>"),OAnswer.push('<p class="spacing"></p>'),OAnswer.push("</div>"),OAnswer.push('<p class="spacing"></p>'),OAnswer.push("</div>"),OAnswer.push("</div>"),OAnswer.push('<p class="spacing15"></p>')}function teachMeToSpeak(){showMes("我:&nbsp;","教我说话"),OAnswer=[],$(".body").length>0,speak(),$(".vtddcntin").append($(OAnswer.join("")))}function showMes(name,content){OAnswer=[],OAnswer.push('<div class="msgright">'),OAnswer.push('<p class="ri"><img src="skin/chat55/images/fi2.jpg" width="55" style="margin-left:5px;"/></p>'),OAnswer.push('<div class="rmsgcontent">'),OAnswer.push('<p class="spacing15"></p>'),OAnswer.push('<div class="metext">'),OAnswer.push('<span class="s1">'+name+"</span>"),OAnswer.push("<span>"+content+"</span>&nbsp;&nbsp;"),OAnswer.push('<span class="s2">'+getTime()+"</span>"),OAnswer.push('<p class="spacing5"></p>'),OAnswer.push("</div>"),OAnswer.push('<div class="ishaveyong"><p class="spacing5"></p></div>'),OAnswer.push('<p class="spacing"></p>'),OAnswer.push("</div>"),OAnswer.push("</div>"),OAnswer.push('<p class="spacing15"></p>'),$(".vtddcntin").append($(OAnswer.join("")))}function setScroll(){$(".nano").nanoScroller({scroll:"bottom"}),$(".nano").nanoScroller({alwaysVisible:!0})}function getTime(){var now=new Date,year=now.getFullYear(),month=now.getMonth()+1,day=now.getDate(),hour=now.getHours(),minute=now.getMinutes(),second=now.getSeconds();return year+"-"+month+"-"+day+" "+hour+":"+minute+":"+second}function $xss(str,type){if(!str)return 0===str?"0":"";switch(type){case"none":return str+"";case"html":return str.replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"}).replace(/ /g," ").replace(/\r\n/g,"").replace(/\n/g,"").replace(/\r/g,"");case"htmlEp":return str.replace(/[&'"<>\/\\\-\x00-\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"});case"url":return escape(str).replace(/\+/g,"%2B");case"miniUrl":return str.replace(/%/g,"%25");case"script":return str.replace(/[\\"']/g,function(r){return"\\"+r}).replace(/%/g,"\\x25").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\x01/g,"\\x01");case"reg":return str.replace(/[\\\^\$\*\+\?\{\}\.\(\)\[\]]/g,function(a){return"\\"+a});default:return escape(str).replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(r){return"&#"+r.charCodeAt(0)+";"}).replace(/ /g," ").replace(/\r\n/g,"<br />").replace(/\n/g,"<br />").replace(/\r/g,"<br />")}}var acoption={max:10,delay:100,matchSubset:!1,scroll:!1,scrollHeight:400,dataType:"json",selectFirst:!1,highlight:function(value,term){var terms=term.split(""),none="";return $.each(terms,function(i,n){-1==none.indexOf(n)&&(none+=n,value=value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+n.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"))}),value.replace("<strong></strong>","")},parse:function(data){for(var rows=[],i=0;i<data.list.length;i++)rows[rows.length]={data:data.list[i],result:data.list[i].question};return rows},formatItem:function(row,i,max){return i+". "+row.question},formatMatch:function(row,i,max){return row},formatResult:function(row){return row}},nu=[],chatContDIv=$("#"+options.chatContDiv),parentchatContDIv=chatContDIv.parent(),$input=$(input),showerrorDiv=$("#"+options.showErrorId),timeout,previousValue="",comeUrl=window.location.href.split("?"),getjid=[];comeUrl[1]&&(getjid=-1!==comeUrl[1].indexOf("jid=")?comeUrl[1].split("&"):[""]),$input.focus(function(){$(this).val()==$(this).attr("oldvalue")&&$(this).val(""),$(this).css("color","#888"),$(this).parent().addClass("robot_inputon")}).blur(function(){""==$(this).val()?($(this).val($(this).attr("oldvalue")),$(this).css("color","#bbb")):$(this).css("color","#888"),$(this).parent().removeClass("robot_inputon")}).autocomplete(options.basePath+"AQ?s=ig&sysNum="+options.sysNum,acoption).result(function(event,row,formatted){event.preventDefault()}).keyup(function(event){var e=event||window.event;return 27==e.keyCode&&$(this).unautocomplete(),isHotKey="Enter"==hkey&&!e.ctrlKey&&13==e.keyCode||"CtrlEnter"==hkey&&e.ctrlKey&&13==e.keyCode,isHotKey?(sendeMsg(),!1):!0}).keydown(function(){word_clu(this)}),options.fadeBackId&&options.fadeBackId.length>2&&$("#"+options.fadeBackId).on("click",function(){fadeback(this)});var r_intQuesUrl=function(){var queTxt=getQueryString("qa"),que=getQueryString("q");queTxt&&(queTxt=decodeURI(queTxt),showMyWordsToForm(queTxt),askQue(queTxt)),que&&(que=decodeURI(que),$input.val(que))};chatContDIv.on("click",".wflink",function(){alert(),$this=$(this);var fid=$this.attr("rel"),cont=$this.html(),s_q_url=options.basePath+"AQ?s=getflw&sysNum="+options.sysNum+"&question="+encodeURI(cont)+"&fid="+fid+"&nocache="+(new Date).getTime();$.getJSON(s_q_url,function(data){0==data.status?(showMyWordsToForm(cont),showRobotWordsToForm(data)):showErrorDiv(data.message)})}),$("body").on("click",".faqevent",function(event){event.preventDefault();var hrefValue=$(this).attr("href"),msgValue=$(this).html(),hrefUrl=options.basePath+"AQ?"+hrefValue+"&sysNum="+options.sysNum+"&nocache="+(new Date).getTime();return showMyWordsToForm(msgValue),request(hrefUrl,showRobotWordsToForm,0,options.dataType,{}),!1});var len,$target,$up,$fkz,$down,wholeH;chatContDIv.on("click",".MN_lookLeaveQue",function(){$(this).text().indexOf("查看")+1?($(".MN_leaveQueBottom").show(),$(this).text("点击关闭")):($(".MN_leaveQueBottom").hide(),$(this).text("点击查看"))}),window.onbeforeunload=function(event){offLine()},initRobotBaseInfo(),options.teachMetalk&&options.teachMetalk.length>2&&$("#"+options.teachMetalk).click(function(){teachMeToSpeak()}),options.fadeBackIdLink&&options.fadeBackIdLink.length>2&&$("#"+options.fadeBackIdLink).click(function(){satisfactionEvaluation()})},$.FaqRobot.defaults={basePath:"./",sysNum:2e6,robotName:"FaqRobot",logoUrl:"skin/demo/image/logo.png",logoDiv:"weblogo",chatContDiv:"chatContentDiv",inputMsgArea:"inputMessage",inputMagOldvalue:"inputMagOldvalue",sendBtn:"sendBtn",closeBtn:"closeBtn",baseInfoDiv:"Contact_us",advInfoDiv:"advInfoDiv",topQuestionDiv:"topQuestions",newQuestionDiv:"newQuestions",sugQuestionDiv:"sugQuestions",viewUrlDiv:"viewUrlDiv",dataType:"json",extraParams:"",webUrl:"http://www.faqrobot.org",authUrl:"",maxTopQuestions:7,queConMaxWordsCount:0,showMyWords:function(msg,time){},showRobotWords:!1,autoswitch:0,wordremain:"wordremain",clearScreen:"clearScreen",fadeBackId:"fadeBackId",showErrorId:"showErrorId",advFaqrobot:"advFaqrobot",kfUrl:"skin/zbj2/images/servIcon.png",khUrl:"skin/zbj2/images/userIcon.png",quickLink:"quickLink",recommend:"recommend",sourceId:0,formatWebLog:!1,formatBaseQueCount:!1,showErrorMsg:!1,teachMetalk:"teachMetalk",fadeBackIdLink:"fadeBackIdLink"}}(jQuery);
