(function(b){b.fn.extend({faqrobot:function(m,c){c=b.extend({},b.FaqRobot.defaults,{sysNum:"number"==typeof m?m:1E4},c);return this.each(function(){new b.FaqRobot(this,c)})}});b.FaqRobot=function(m,c){function v(a,d,e,f,g){if("string"==typeof a&&0<a.length){var k={timestamp:+new Date,dataType:f||c.dataType},k=b.extend({},k,g);b.each(c.extraParams,function(a,d){k[a]="function"==typeof d?d():d});b.ajax({dataType:c.dataType,url:encodeURI(a),data:k,success:function(a){var b=c.parse&&c.parse(a)||a;0>b.status&&
"function"==typeof e?e(b):-1==b.status?c.showErrorMsg&&c.showErrorMsg(a)||setTimeout(x(b.message||"\u8bf7\u6c42\u4fe1\u606f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\uff01"),2E3):-2==b.status?c.showErrorMsg&&c.showErrorMsg(a)||setTimeout(x(b.message||"\u60a8\u7684\u4fe1\u606f\u8ba4\u8bc1\u672a\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1\uff01",c.authUrl),2E3):(keepCount=0,A(b),"function"==typeof d&&d(b))},error:function(){c.showErrorMsg&&c.showErrorMsg(data)||x("\u6570\u636e\u8bf7\u6c42\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\uff01")}})}}
function x(a,d,b){r(a,function(){d&&"string"==typeof d&&(location.href=d)})}function I(a){var d=b("<div/>").addClass("staff-msg");b("<div/>").addClass("name").appendTo(d).html(c.robotName);b("<div/>").addClass("logoSize").html('<img class="img-circle" src='+c.kfUrl+">").appendTo(d);var e=b("<div/>").addClass("msg logoMsg").appendTo(d),f=b("<div/>").addClass("content").appendTo(e);b("<span/>").addClass("msg-status").appendTo(e);f.html(a.helloWord||a.webConfig.helloWord);l.html(d);d=b("<div/>").addClass("staff-msg");
b("<div/>").addClass("name").appendTo(d).html(c.robotName);b("<div/>").addClass("logoSize").html('<img class="img-circle" src='+c.kfUrl+">").appendTo(d);f=b("<div/>").addClass("msg logoMsg").appendTo(d);e=b("<div/>").addClass("content").appendTo(f);b("<span/>").addClass("msg-status").appendTo(f);if(a.guideQuestions&&0<a.guideQuestions.length){f=[];f.push("<p>\u6211\u731c\u60a8\u60f3\u95ee\uff1a</p>");f.push("<ol>");for(var g=0;g<a.guideQuestions.length;g++)f.push('<li><a href="javascript:;" class="welcomeWords" aId="'+
a.guideQuestions[g].solutionId+'" >'+a.guideQuestions[g].question+"</a></li>");f.push("</ol>");e.html(f.join(""));l.append(d)}}function J(a){c.topQuestionDiv&&2<c.topQuestionDiv.length&&"undefined"!=typeof a&&1<a.length&&B(c.topQuestionDiv,a)}function K(a){c.newQuestionDiv&&2<c.newQuestionDiv.length&&"undefined"!=typeof a&&1<a.length&&B(c.newQuestionDiv,a)}function L(a){if(c.baseInfoDiv&&2<c.baseInfoDiv.length&&"undefined"!=typeof a.webConfig&&1<a.webConfig.length){var d='<div class="Contact_us"><strong>\u8054\u7cfb\u6211\u4eec\uff1a</strong>';
"undefined"!=typeof a.webConfig.webName&&(d+="<p>\u540d\u79f0\uff1a"+a.webConfig.webName+"</p>");"undefined"!=typeof a.webConfig.serviceTel&&(d+="<p>\u7535\u8bdd\uff1a"+a.webConfig.serviceTel+"</p>");"undefined"!=typeof a.webConfig.webSite&&(d+='<p>\u7f51\u5740\uff1a<a href="'+a.webConfig.webSite+'" target="_black">'+a.webConfig.webSite+"</a></p>");d+="</div>";b("#"+c.baseInfoDiv).html(d)}}function M(a){if(c.advInfoDiv&&2<c.advInfoDiv.length&&"undefined"!=typeof a.webConfig&&1<a.webConfig.length){var d=
"<table>";"undefined"!=typeof a.webConfig.serviceQq&&(d+='<tr><td>Q\u00a0Q\uff1a</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+a.webConfig.serviceQq+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+a.webConfig.serviceQq+':51" alt="QQ\u5728\u7ebf\u5ba2\u670d" title="QQ\u5728\u7ebf\u5ba2\u670d"/></a></td></tr>');if("undefined"!=typeof a.advs)for(a=a.advs,i=0;i<a.length;i++){var e=b.trim(a[i].name),f=b.trim(a[i].value),g=a[i].type;0==g?d+="<tr><td>"+e+"\uff1a</td><td>"+
f+"</td></tr>":1==g?d+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":2==g?d+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":3==g&&(d+="<tr><td>"+e+'\uff1a</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+f+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+f+':51" alt="'+e+'" title="'+e+'"/></a></td></tr>')}d+="</table>";b("#"+c.advInfoDiv).html(d)}}function N(a,d){a&&2<a.length&&d&&0<d.length&&b("#"+a).html(d)}function B(a,d,e,f,g){if(!d)return"";a=b("<dl/>").appendTo(b("#"+
a));e=C(d.length);for(f=0;f<e;f++)if(d[f]){g=b("<dt/>");var k=c.formatBaseQueCount&&c.formatBaseQueCount(d[f],f+1,e,c.queConMaxWordsCount)||D(d[f].question);!1!==k&&(b("<a/>").html(k).appendTo(g).attr("href","javascript:void(0)").attr("title",d[f].question).attr("aid",d[f].solutionId).click(function(){$this=b(this);t($this.attr("title"),$this.attr("aid"));return!1}),g.appendTo(a))}}function D(a,d){return d?a.length>d?a.substring(0,d)+"...":a:a}function C(a){return c.maxTopQuestions&&c.maxTopQuestions<
a?c.maxTopQuestions:a}function w(){var a=new Date,d=a.getFullYear(),b=a.getMonth()+1,c=a.getDate(),g=a.getHours(),k=a.getMinutes(),a=a.getSeconds();return d+"-"+b+"-"+c+" "+g+":"+k+":"+a}function r(a,d){y.fadeIn(800);y.find("span").html(a);y.delay(1E3).fadeTo("slow",.2).fadeTo("slow",1).fadeOut(800,function(){"function"==typeof d&&d()})}function E(){var a;a=n.val();a=a.replace(/[\r\n]/g,"");""!=a&&a!=c.inputMagOldvalue&&(n.val(""),b(".ac_results").hide(),1==a.length&&0<a&&"undefined"!=typeof u[a-
1]&&(a=u[a-1],u=[]),t(a),b("#"+c.wordremain).html(100),n.focus())}function t(a,d){if(a&&0<a.length){var b=c.basePath+"AQ?s=aq";d&&0<d++&&(b+="&sId="+d+"&sysNum="+c.sysNum);z(a);v(b,q,0,c.dataType,{question:a})}}function z(a){if(a||0!=a.length){var b;(b=c.showMyWords&&c.showMyWords(a,w()))||(w(),b='<div  class="client-msg" data-type="text"><div class="logoSize" style="right:0"><img class="img-circle" alt="" src="'+c.khUrl+'"></div><div class="msg rightLogo"><div class="content">'+a+'</div><span class="msg-status"></span> </div> </div>');
l.append(b);l.scrollTop(l[0].scrollHeight)}}function q(a){if(a||0!=a.length){var b;if(!(b=c.showRobotWords&&c.showRobotWords(a,w())))if(b=w(),"undefined"==typeof a.robotAnswer||0==a.robotAnswer.length)b="";else{for(var e,f,g=0;g<a.robotAnswer.length;g++)f=a.robotAnswer[g],f=O(f,b),e?e.after(f):e=f;b=e}l.append(b);l.scrollTop(l[0].scrollHeight)}}function O(a,d){var e="";d="";"undefined"!=typeof a.gusWords&&null!=a.gusWords?(e=""==a.gusWords.ydWords?"\u60a8\u662f\u4e0d\u662f\u8981\u54a8\u8be2\u4e0b\u9762\u7684\u95ee\u9898\uff1f":
a.gusWords.ydWords,d=""==a.gusWords.afterWords?"":a.gusWords.afterWords):(e="\u60a8\u662f\u4e0d\u662f\u8981\u54a8\u8be2\u4e0b\u9762\u7684\u95ee\u9898\uff1f",d="");if(!a)return"";var f=b("<div/>").addClass("staff-msg");b("<div/>").addClass("name").appendTo(f).html(c.robotName);b("<div/>").addClass("logoSize").html('<img class="img-circle" src='+c.kfUrl+">").appendTo(f);var g=b("<div/>").addClass("msg logoMsg").appendTo(f),k=b("<div/>").addClass("content").appendTo(g),h=b("<div/>").addClass("content").appendTo(g),
l=b("<div/>").addClass("content").appendTo(g);b("<span/>").addClass("msg-status").appendTo(g);g=b("<div/>").addClass("content").appendTo(g);if("undefined"!=typeof a.aId&&0!=a.aId){var p=a.aId,m=a.cluid;g.addClass("helper_aid_"+p).addClass("helper");b("<a/>").addClass("robot_review_yes").attr("helptag",1).attr("aid",p).attr("cluid",m).click(F).html('<span class="robot_help_yes"></span>').appendTo(g);b("<a/>").addClass("robot_review_no").attr("helptag",0).attr("aid",p).attr("cluid",m).click(F).html('<span class="robot_help_no"></span>').appendTo(g)}if("undefined"!=
typeof a.aId&&0!=a.aId&&c.sugQuestionDiv&&2<c.sugQuestionDiv.length&&"undefined"!=typeof a.relateLessList&&1<a.relateLessList.length){g=a.relateLessList;if(!g)return"";for(var n=b("<span/>").addClass("question").html("\u4f60\u662f\u5426\u8fd8\u60f3\u95ee\u5982\u4e0b\u95ee\u9898\uff1a").appendTo(h),n=b("<ol/>").appendTo(h),q=C(g.length),h=0;h<q;h++)if(g[h]){var r=c.formatBaseQueCount&&c.formatBaseQueCount(g[h],h+1,q,c.queConMaxWordsCount)||D(g[h].question);!1!==r&&(p=b("<li/>").appendTo(n),m=b("<a/>"),
m.html(r).appendTo(p).attr("href","javascript:void(0)").attr("title",g[h].question).attr("aid",g[h].solutionId).click(function(){$this=b(this);t($this.attr("title"),$this.attr("aid"));return!1}),u[h]=g[h].question)}}""!=a.ansCon&&0<a.ansCon.length&&k.html(a.ansCon);if(0<a.relateList.length){n=b("<dl/>").append("<dt>"+e+"</dt>").appendTo(l);g=a.relateList;e=b("<ol/>").appendTo(l);for(h=0;h<g.length;h++)a=b.trim(g[h].question),p=g[h].solutionId,p=b("<li/>").appendTo(e),m=b("<a/>"),m.html(a).appendTo(p).attr("href",
"javascript:void(0)").attr("title",a).attr("aid",g[h].solutionId).click(function(){$this=b(this);t($this.attr("title"),$this.attr("aid"));return!1}),u[h]=a;b("<dt/>").html(d).appendTo(n);return f}if(0<a.gusList.length){n=b("<span/>").addClass("question").html(e).appendTo(l);e=b("<ol/>").appendTo(l);k=a.gusList;for(h=0;h<k.length;h++)a=b.trim(k[h].seedQuestion.question),p=k[h].solutionId,p=b("<li/>").appendTo(e),m=b("<a/>"),m.html(a).appendTo(p).attr("href","javascript:void(0)").attr("title",a).attr("aid",
k[h].solutionId).click(function(){$this=b(this);t($this.attr("title"),$this.attr("aid"));return!1}),u[h]=a;b("<span/>").addClass("question").html(d).appendTo(l);return f}if(""==a.ansCon)return k.html("\u00a0"),f;k.html(a.ansCon);return f}function G(){var a=c.basePath+"AQ?s=offline&nocache="+(new Date).getTime();b.getJSON(a,function(a){0==a.status&&(a=eval('({"robotAnswer":{"ansCon":"\u60a8\u5df2\u4e0b\u7ebf\uff0c\u611f\u8c22\u60a8\u7684\u4f7f\u7528\uff01\u5982\u679c\u9700\u8981\u518d\u6b21\u804a\u5929\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u6216\u5237\u65b0\u672c\u9875\u9762\uff01","status":0,"tspan":2}})'),
q(a))})}function A(a){"undefined"!=typeof a.tspan&&(s_tspan!=a.tspan&&(s_tspan=a.tspan),"undefined"!=typeof dt&&clearTimeout(dt),100>s_tspan&&240>keepCount?(keepCount++,dt=setTimeout(P,1E3*s_tspan)):G())}function P(){var a=b.trim(n.text());b.ajax({type:"post",datatype:"json",cache:!1,url:c.basePath+"AQ?s=kl",data:"question="+encodeURI(a),success:function(a){0==a.status?(A(a),a.robotAnswer&&0<a.robotAnswer.length&&q(a)):(a=eval('({"robotAnswer":{"ansCon":"\u60a8\u5df2\u4e0b\u7ebf\uff0c\u611f\u8c22\u60a8\u7684\u4f7f\u7528\uff01\u5982\u679c\u9700\u8981\u518d\u6b21\u804a\u5929\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u6216\u5237\u65b0\u672c\u9875\u9762\uff01","status":0,"tspan":2}})'),
q(a))}})}function F(){$this=b(this);var a=$this.attr("aid"),d=$this.attr("cluid"),e="",e=1==$this.attr("helptag")?c.basePath+"AQ?s=addufc&aId="+a+"&sysNum="+c.sysNum+"&cluid="+d:c.basePath+"AQ?s=addulc&aId="+a+"&sysNum="+c.sysNum+"&cluid="+d;v(e,function(c){b(".helper_aid_"+a).html(c.message)})}function Q(){$this=b(this);var a=$this.parents("form"),d=c.basePath+"AQ?s=fadeback&sysNum="+c.sysNum,e="",f=b("input[name='reason[]']");for(i=0;i<f.length;i++)f[i].checked&&(e+=f[i].value+",");a.find("input[name=sub]").val(e);
b.ajax({type:"get",datatype:"json",cache:!1,url:encodeURI(d),data:a.serialize(),success:function(c){b(".fadeBackModal").fadeOut(800);b(".fadeBackContent").fadeOut(800);a[0].reset();r(c.message)}})}var u=[],l=b("#"+c.chatContDiv);l.parent();var n=b(m),y=b("#"+c.showErrorId);m=window.location.href.split("?");var H=[],H=-1!==m[1].indexOf("jid=")?m[1].split("&"):[""];n.focus(function(){b(this).val()==b(this).attr("oldvalue")&&b(this).val("");b(this).css("color","#333");b(this).parent().addClass("robot_inputon")}).blur(function(){""==
b(this).val()?(b(this).val(b(this).attr("oldvalue")),b(this).css("color","#ccc")):b(this).css("color","#333");b(this).parent().removeClass("robot_inputon")}).autocomplete(c.basePath+"AQ?s=ig&sysNum="+c.sysNum,{max:6,delay:500,matchSubset:!1,scroll:!1,minChars:2,scrollHeight:400,dataType:"json",selectFirst:!1,highlight:function(a,c){c=c.split("");var d="";b.each(c,function(b,c){-1==d.indexOf(c)&&(d+=c,a=a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+c.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+
")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"))});return a.replace("<strong></strong>","")},parse:function(a){for(var b=[],c=0;c<a.list.length;c++)b[b.length]={data:a.list[c],result:a.list[c].question};return b},formatItem:function(a,b,c){return b+". "+a.question},formatMatch:function(a,b,c){return a},formatResult:function(a){return a}}).result(function(a,b,c){a.preventDefault()}).keyup(function(a){a=a||window.event;27==a.keyCode&&b(this).unautocomplete();return(isHotKey=!a.ctrlKey&&13==a.keyCode||
a.ctrlKey&&13==a.keyCode)?(E(),!1):!0}).keydown(function(){var a=this.value.length,d=0,e=this.value.match(/[\u4E00-\u9FA5\uF900-\uFA2D]/g);null!=e&&(d+=e.length);a=b(this).attr("maxLength")-d-a;if(0>=a){a=0;d=this.value.substring(0,this.maxLength);for(e=0;e<d.length&&!(a+=/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(d.charAt(e))?2:1,a>this.maxLength);e++);this.value=d.substring(0,e);b("#"+c.wordremain).html(0)}else b("#"+c.wordremain).html(a)});c.fadeBackId&&2<c.fadeBackId.length&&b("#"+c.fadeBackId).click(Q);
b(".wflink").live("click",function(){$this=b(this);var a=$this.attr("rel"),d=$this.html(),a=c.basePath+"AQ?s=getflw&sysNum="+c.sysNum+"&question="+encodeURI(d)+"&fid="+a+"&nocache="+(new Date).getTime();b.getJSON(a,function(a){0==a.status?(z(d),q(a)):r(a.message)})});b(".faqevent").live("click",function(){var a=b(this).attr("href"),d=b(this).html(),a=c.basePath+"AQ?"+a+"&sysNum="+c.sysNum+"&nocache="+(new Date).getTime();z(d);v(a,q,0,c.dataType,{});return!1});window.onbeforeunload=function(a){G()};
b("#"+c.chatContDiv).on("click",".welcomeWords",function(){t(b(this).html())});-1!==window.location.href.indexOf("sysNum=")&&(c.sysNum=window.location.href.split("sysNum=")[1].replace("#",""));n.attr("value",c.inputMagOldvalue);n.attr("oldvalue",c.inputMagOldvalue);n.text(c.inputMagOldvalue);v(c.basePath+"AQ?s=p&sysNum="+c.sysNum+"&sourceId="+c.sourceId+"&"+H[0],function(a){urlId=location.href.split("?");if(-1==a.status)r("\u7f51\u7edc\u6709\u70b9\u4e0d\u7ed9\u529b\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u5c1d\u8bd5\u3002");
else if(-2==a.status)r("\u60a8\u7684\u4fe1\u606f\u8ba4\u8bc1\u672a\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1\uff01"),location.href=a.loginurl;else{"undefined"!=typeof a.webConfig.robotName&&(c.robotName=a.webConfig.robotName);"undefined"!=typeof a.webConfig.logoUrl&&(c.logoUrl=""==a.webConfig.logoUrl?"skin/mobileFees1/images/home.png":a.webConfig.logoUrl,b("#"+c.logoDiv).attr("src",c.logoUrl));var d=c.formatWebLog&&c.formatWebLog(a)||(c.logoDiv&&2<c.logoDiv.length&&"undefined"!=typeof a.logo&&
20<a.logo.length?'<a href="'+("undefined"!=typeof a.webSite?a.webSite:"#")+'" target="_black"><img class="logo" alt="'+("undefined"!=typeof a.webName?a.webName:"logo")+'" src="'+a.logo+'"/></a>':"");N(c.logoDiv,d);I(a);J(a.topAsk);K(a.newAdd);L(a.webConfig);M(a);b("#"+c.sendBtn).click(function(){E()});b("#"+c.clearScreen).click(function(){var a=b("<div/>").addClass("robot_question"),c=l.find("div").first().html();l.html("");a.html(c).appendTo(l)})}})};b.FaqRobot.defaults={basePath:"./",sysNum:2E6,
robotName:"FaqRobot",logoDiv:"weblogo",chatContDiv:"chatContentDiv",inputMsgArea:"inputMessage",inputMagOldvalue:"inputMagOldvalue",sendBtn:"sendBtn",closeBtn:"closeBtn",baseInfoDiv:"Contact_us",advInfoDiv:"advInfoDiv",topQuestionDiv:"topQuestions",newQuestionDiv:"newQuestions",sugQuestionDiv:"sugQuestions",viewUrlDiv:"viewUrlDiv",dataType:"json",extraParams:"",webUrl:"http://www.faqrobot.org",authUrl:"",maxTopQuestions:7,queConMaxWordsCount:0,showMyWords:function(b,c){},showRobotWords:!1,autoswitch:0,
wordremain:"wordremain",clearScreen:"clearScreen",fadeBackId:"fadeBackId",showErrorId:"showErrorId",kfUrl:"skin/fees1/image/logo.png",khUrl:"skin/mobileFees1/images/ask.png",sourceId:0,formatWebLog:!1,formatBaseQueCount:!1,showErrorMsg:!1}})(jQuery);