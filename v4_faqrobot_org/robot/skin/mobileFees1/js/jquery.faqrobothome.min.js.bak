(function(b){b.fn.extend({faqrobot:function(r,c){c=b.extend({},b.FaqRobot.defaults,{sysNum:"number"==typeof r?r:1E4},c);return this.each(function(){new b.FaqRobot(this,c)})}});b.FaqRobot=function(r,c){function w(a,d,e,f,k){if("string"==typeof a&&0<a.length){var g={timestamp:+new Date,dataType:f||c.dataType},g=b.extend({},g,k);b.each(c.extraParams,function(a,d){g[a]="function"==typeof d?d():d});b.ajax({dataType:c.dataType,url:encodeURI(a),data:g,success:function(a){var b=c.parse&&c.parse(a)||a;0>b.status&&
"function"==typeof e?e(b):-1==b.status?c.showErrorMsg&&c.showErrorMsg(a)||setTimeout(y(b.message||"\u8bf7\u6c42\u4fe1\u606f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\uff01"),2E3):-2==b.status?c.showErrorMsg&&c.showErrorMsg(a)||setTimeout(y(b.message||"\u60a8\u7684\u4fe1\u606f\u8ba4\u8bc1\u672a\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1\uff01",c.authUrl),2E3):(keepCount=0,B(b),"function"==typeof d&&d(b))},error:function(){c.showErrorMsg&&c.showErrorMsg(data)||y("\u6570\u636e\u8bf7\u6c42\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\uff01")}})}}
function y(a,d,b){q(a,function(){d&&"string"==typeof d&&(location.href=d)})}function K(a){var d=b("<div/>").addClass("staff-msg");b("<div/>").addClass("name").appendTo(d).html(c.robotName);b("<div/>").addClass("logoSize").html('<img class="img-circle" src='+c.kfUrl+">").appendTo(d);var e=b("<div/>").addClass("msg logoMsg").appendTo(d),f=b("<div/>").addClass("content").appendTo(e);b("<span/>").addClass("msg-status").appendTo(e);c.chatContDiv&&2<c.chatContDiv.length&&"undefined"!=typeof a.leaveQue&&
1<a.leaveQue.length||f.html(a.webConfig.helloWord);l.html(d)}function L(a){c.topQuestionDiv&&2<c.topQuestionDiv.length&&"undefined"!=typeof a&&1<a.length&&C(c.topQuestionDiv,a)}function M(a){c.newQuestionDiv&&2<c.newQuestionDiv.length&&"undefined"!=typeof a&&1<a.length&&C(c.newQuestionDiv,a)}function N(a){if(c.baseInfoDiv&&2<c.baseInfoDiv.length&&"undefined"!=typeof a.webConfig&&1<a.webConfig.length){var d='<div class="Contact_us"><strong>\u8054\u7cfb\u6211\u4eec\uff1a</strong>';"undefined"!=typeof a.webConfig.webName&&
(d+="<p>\u540d\u79f0\uff1a"+a.webConfig.webName+"</p>");"undefined"!=typeof a.webConfig.serviceTel&&(d+="<p>\u7535\u8bdd\uff1a"+a.webConfig.serviceTel+"</p>");"undefined"!=typeof a.webConfig.webSite&&(d+='<p>\u7f51\u5740\uff1a<a href="'+a.webConfig.webSite+'" target="_black">'+a.webConfig.webSite+"</a></p>");d+="</div>";b("#"+c.baseInfoDiv).html(d)}}function O(a){if(c.advInfoDiv&&2<c.advInfoDiv.length&&"undefined"!=typeof a.webConfig&&1<a.webConfig.length){var d="<table>";"undefined"!=typeof a.webConfig.serviceQq&&
(d+='<tr><td>Q\u00a0Q\uff1a</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+a.webConfig.serviceQq+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+a.webConfig.serviceQq+':51" alt="QQ\u5728\u7ebf\u5ba2\u670d" title="QQ\u5728\u7ebf\u5ba2\u670d"/></a></td></tr>');if("undefined"!=typeof a.advs)for(a=a.advs,i=0;i<a.length;i++){var e=b.trim(a[i].name),f=b.trim(a[i].value),k=a[i].type;0==k?d+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":1==k?d+="<tr><td>"+e+"\uff1a</td><td>"+
f+"</td></tr>":2==k?d+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":3==k&&(d+="<tr><td>"+e+'\uff1a</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+f+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+f+':51" alt="'+e+'" title="'+e+'"/></a></td></tr>')}d+="</table>";b("#"+c.advInfoDiv).html(d)}}function P(a,d){a&&2<a.length&&d&&0<d.length&&b("#"+a).html(d)}function C(a,d,e,f,k){if(!d)return"";a=b("<dl/>").appendTo(b("#"+a));e=D(d.length);for(f=0;f<e;f++)if(d[f]){k=
b("<dt/>");var g=c.formatBaseQueCount&&c.formatBaseQueCount(d[f],f+1,e,c.queConMaxWordsCount)||E(d[f].question);!1!==g&&(b("<a/>").html(g).appendTo(k).attr("href","javascript:void(0)").attr("title",d[f].question).attr("aid",d[f].solutionId).click(function(){$this=b(this);t($this.attr("title"),$this.attr("aid"));return!1}),k.appendTo(a))}}function E(a,d){return d?a.length>d?a.substring(0,d)+"...":a:a}function D(a){return c.maxTopQuestions&&c.maxTopQuestions<a?c.maxTopQuestions:a}function x(){var a=
new Date,d=a.getFullYear(),b=a.getMonth()+1,c=a.getDate(),k=a.getHours(),g=a.getMinutes(),a=a.getSeconds();return d+"-"+b+"-"+c+" "+k+":"+g+":"+a}function q(a,d){z.fadeIn(800);z.find("span").html(a);z.delay(1E3).fadeTo("slow",.2).fadeTo("slow",1).fadeOut(800,function(){"function"==typeof d&&d()})}function F(){var a="",a=m.val(),a=a.replace(/[\r\n]/g,"");""!=a&&a!=c.inputMagOldvalue&&(m.val(""),b(".ac_results").hide(),1==a.length&&0<a&&"undefined"!=typeof u[a-1]&&(a=u[a-1],u=[]),t(a),b("#"+c.wordremain).html(100),
m.focus())}function t(a,d){if(a&&0<a.length){var b=c.basePath+"AQ?s=aq";d&&0<d++&&(b+="&sId="+d+"&sysNum="+c.sysNum);A(a);w(b,n,0,c.dataType,{question:a})}}function A(a){if(a||0!=a.length){var d;(d=c.showMyWords&&c.showMyWords(a,x()))||(x(),d='<div  class="client-msg" data-type="text"><div class="logoSize" style="right:0"><img class="img-circle" alt="" src="'+c.khUrl+'"></div><div class="msg rightLogo"><div class="content">'+a+'</div><span class="msg-status"></span> </div> </div>');l.append(d);l.scrollTop(l[0].scrollHeight)}}
function n(a){if(a||0!=a.length){var d;if(!(d=c.showRobotWords&&c.showRobotWords(a,x())))if(d=x(),"undefined"==typeof a.robotAnswer||0==a.robotAnswer.length)d="";else{for(var b,f,k=0;k<a.robotAnswer.length;k++)f=a.robotAnswer[k],f=Q(f,d),b?b.after(f):b=f;d=b}l.append(d);l.scrollTop(l[0].scrollHeight)}}function Q(a,d){var e="",f="";"undefined"!=typeof a.gusWords&&null!=a.gusWords?(e=""==a.gusWords.ydWords?"\u60a8\u662f\u4e0d\u662f\u8981\u54a8\u8be2\u4e0b\u9762\u7684\u95ee\u9898\uff1f":a.gusWords.ydWords,
f=""==a.gusWords.afterWords?"":a.gusWords.afterWords):(e="\u60a8\u662f\u4e0d\u662f\u8981\u54a8\u8be2\u4e0b\u9762\u7684\u95ee\u9898\uff1f",f="");if(!a)return"";var k=b("<div/>").addClass("staff-msg");b("<div/>").addClass("name").appendTo(k).html(c.robotName);b("<div/>").addClass("logoSize").html('<img class="img-circle" src='+c.kfUrl+">").appendTo(k);var g=b("<div/>").addClass("msg logoMsg").appendTo(k),l=b("<div/>").addClass("content").appendTo(g),h=b("<div/>").addClass("content").appendTo(g),m=b("<div/>").addClass("content").appendTo(g);
b("<span/>").addClass("msg-status").appendTo(g);g=b("<div/>").addClass("content").appendTo(g);if("undefined"!=typeof a.aId&&0!=a.aId){var p=a.aId;g.addClass("helper_aid_"+p).addClass("helper");b("<a/>").addClass("robot_review_yes").attr("helptag",1).attr("aid",p).click(G).html('<span class="robot_help_yes"></span>').appendTo(g);b("<a/>").addClass("robot_review_no").attr("helptag",0).attr("aid",p).click(G).html('<span class="robot_help_no"></span>').appendTo(g)}if("undefined"!=typeof a.aId&&0!=a.aId&&
c.sugQuestionDiv&&2<c.sugQuestionDiv.length&&"undefined"!=typeof a.relateLessList&&1<a.relateLessList.length){g=a.relateLessList;if(!g)return"";for(var n=b("<span/>").addClass("question").html("\u4f60\u662f\u5426\u8fd8\u60f3\u95ee\u5982\u4e0b\u95ee\u9898\uff1a").appendTo(h),n=b("<ol/>").appendTo(h),r=D(g.length),h=0;h<r;h++)if(g[h]){var q=c.formatBaseQueCount&&c.formatBaseQueCount(g[h],h+1,r,c.queConMaxWordsCount)||E(g[h].question);if(!1!==q){var p=b("<li/>").appendTo(n),v=b("<a/>");v.html(q).appendTo(p).attr("href",
"javascript:void(0)").attr("title",g[h].question).attr("aid",g[h].solutionId).click(function(){$this=b(this);t($this.attr("title"),$this.attr("aid"));return!1});u[h]=g[h].question}}}""!=a.ansCon&&0<a.ansCon.length&&l.html(a.ansCon);if(0<a.relateList.length){n=b("<dl/>").append("<dt>"+e+"</dt>").appendTo(m);g=a.relateList;e=b("<ol/>").appendTo(m);for(h=0;h<g.length;h++)l=b.trim(g[h].question),p=g[h].solutionId,p=b("<li/>").appendTo(e),v=b("<a/>"),v.html(l).appendTo(p).attr("href","javascript:void(0)").attr("title",
l).attr("aid",g[h].solutionId).click(function(){$this=b(this);t($this.attr("title"),$this.attr("aid"));return!1}),u[h]=l;b("<dt/>").html(f).appendTo(n);return k}if(0<a.gusList.length){n=b("<span/>").addClass("question").html(e).appendTo(m);e=b("<ol/>").appendTo(m);g=a.gusList;for(h=0;h<g.length;h++)l=b.trim(g[h].seedQuestion.question),p=g[h].solutionId,p=b("<li/>").appendTo(e),v=b("<a/>"),v.html(l).appendTo(p).attr("href","javascript:void(0)").attr("title",l).attr("aid",g[h].solutionId).click(function(){$this=
b(this);t($this.attr("title"),$this.attr("aid"));return!1}),u[h]=l;b("<span/>").addClass("question").html(f).appendTo(m);return k}if(""==a.ansCon)return l.html("\u00a0"),k;l.html(a.ansCon);return k}function H(){var a=c.basePath+"AQ?s=offline&nocache="+(new Date).getTime();b.getJSON(a,function(a){0==a.status&&(a=eval('({"robotAnswer":{"ansCon":"\u60a8\u5df2\u4e0b\u7ebf\uff0c\u611f\u8c22\u60a8\u7684\u4f7f\u7528\uff01\u5982\u679c\u9700\u8981\u518d\u6b21\u804a\u5929\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u6216\u5237\u65b0\u672c\u9875\u9762\uff01","status":0,"tspan":2}})'),
n(a))})}function B(a){"undefined"!=typeof a.tspan&&(s_tspan!=a.tspan&&(s_tspan=a.tspan),"undefined"!=typeof dt&&clearTimeout(dt),100>s_tspan&&240>keepCount?(keepCount++,dt=setTimeout(R,1E3*s_tspan)):H())}function R(){var a=b.trim(m.text());b.ajax({type:"post",datatype:"json",cache:!1,url:c.basePath+"AQ?s=kl",data:"question="+encodeURI(a),success:function(a){0==a.status?(B(a),a.robotAnswer&&0<a.robotAnswer.length&&n(a)):(a=eval('({"robotAnswer":{"ansCon":"\u60a8\u5df2\u4e0b\u7ebf\uff0c\u611f\u8c22\u60a8\u7684\u4f7f\u7528\uff01\u5982\u679c\u9700\u8981\u518d\u6b21\u804a\u5929\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u6216\u5237\u65b0\u672c\u9875\u9762\uff01","status":0,"tspan":2}})'),
n(a))}})}function G(){$this=b(this);var a=$this.attr("aid"),d=$this.attr("helptag");b(".helper_aid_"+a).html("\u611f\u8c22\u60a8\u7684\u8bc4\u4ef7\uff01");var e="",e=1==d?c.basePath+"AQ?s=addufc&aId="+a+"&sysNum="+c.sysNum:c.basePath+"AQ?s=addulc&aId="+a+"&sysNum="+c.sysNum;w(e)}function S(){$this=b(this);var a=$this.parents("form"),d=c.basePath+"AQ?s=fadeback&sysNum="+c.sysNum,e="",f=b("input[name='reason[]']");for(i=0;i<f.length;i++)f[i].checked&&(e+=f[i].value+",");a.find("input[name=sub]").val(e);
b.ajax({type:"get",datatype:"json",cache:!1,url:encodeURI(d),data:a.serialize(),success:function(d){b(".fadeBackModal").fadeOut(800);b(".fadeBackContent").fadeOut(800);a[0].reset();q(d.message)}})}var u=[],l=b("#"+c.chatContDiv);l.parent();var m=b(r),z=b("#"+c.showErrorId),I=window.location.href.split("?"),J=[],J=-1!==I[1].indexOf("jid=")?I[1].split("&"):[""];m.focus(function(){b(this).val()==b(this).attr("oldvalue")&&b(this).val("");b(this).css("color","#333");b(this).parent().addClass("robot_inputon")}).blur(function(){""==
b(this).val()?(b(this).val(b(this).attr("oldvalue")),b(this).css("color","#ccc")):b(this).css("color","#333");b(this).parent().removeClass("robot_inputon")}).autocomplete(c.basePath+"AQ?s=ig&sysNum="+c.sysNum,{max:10,delay:500,matchSubset:!1,scroll:!1,minChars:2,scrollHeight:400,dataType:"json",selectFirst:!1,highlight:function(a,d){var c=d.split(""),f="";b.each(c,function(b,d){-1==f.indexOf(d)&&(f+=d,a=a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+d.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,
"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"))});return a.replace("<strong></strong>","")},parse:function(a){for(var b=[],c=0;c<a.list.length;c++)b[b.length]={data:a.list[c],result:a.list[c].question};return b},formatItem:function(a,b,c){return b+". "+a.question},formatMatch:function(a,b,c){return a},formatResult:function(a){return a}}).result(function(a,b,c){a.preventDefault()}).keyup(function(a){a=a||window.event;27==a.keyCode&&b(this).unautocomplete();return(isHotKey=!a.ctrlKey&&
13==a.keyCode||a.ctrlKey&&13==a.keyCode)?(F(),!1):!0}).keydown(function(){var a=this.value.length,d=0,e=this.value.match(/[\u4E00-\u9FA5\uF900-\uFA2D]/g);null!=e&&(d+=e.length);a=b(this).attr("maxLength")-d-a;if(0>=a){a=0;d=this.value.substring(0,this.maxLength);for(e=0;e<d.length&&!(a+=/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(d.charAt(e))?2:1,a>this.maxLength);e++);this.value=d.substring(0,e);b("#"+c.wordremain).html(0)}else b("#"+c.wordremain).html(a)});c.fadeBackId&&2<c.fadeBackId.length&&b("#"+c.fadeBackId).click(S);
b(".wflink").live("click",function(){$this=b(this);var a=$this.attr("rel"),d=$this.html(),a=c.basePath+"AQ?s=getflw&sysNum="+c.sysNum+"&question="+encodeURI(d)+"&fid="+a+"&nocache="+(new Date).getTime();b.getJSON(a,function(a){0==a.status?(A(d),n(a)):q(a.message)})});b(".faqevent").live("click",function(){var a=b(this).attr("href"),d=b(this).html(),a=c.basePath+"AQ?"+a+"&sysNum="+c.sysNum+"&nocache="+(new Date).getTime();A(d);w(a,n,0,c.dataType,{});return!1});window.onbeforeunload=function(a){H()};
b("#"+c.chatContDiv).on("click",".welcomeWords",function(){t(b(this).html())});-1!==window.location.href.indexOf("sysNum=")&&(c.sysNum=window.location.href.split("sysNum=")[1].replace("#",""));m.attr("value",c.inputMagOldvalue);m.attr("oldvalue",c.inputMagOldvalue);m.text(c.inputMagOldvalue);w(c.basePath+"AQ?s=p&sysNum="+c.sysNum+"&sourceId="+c.sourceId+"&"+J[0],function(a){urlId=location.href.split("?");if(-1==a.status)q("\u7f51\u7edc\u6709\u70b9\u4e0d\u7ed9\u529b\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u5c1d\u8bd5\u3002");
else if(-2==a.status)q("\u60a8\u7684\u4fe1\u606f\u8ba4\u8bc1\u672a\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1\uff01"),location.href=a.loginurl;else{"undefined"!=typeof a.webConfig.robotName&&(c.robotName=a.webConfig.robotName);"undefined"!=typeof a.webConfig.logoUrl&&(c.logoUrl=""==a.webConfig.logoUrl?"skin/mobileFees1/images/home.png":a.webConfig.logoUrl,b("#"+c.logoDiv).attr("src",c.logoUrl));var d=c.formatWebLog&&c.formatWebLog(a)||(c.logoDiv&&2<c.logoDiv.length&&"undefined"!=typeof a.logo&&
20<a.logo.length?'<a href="'+("undefined"!=typeof a.webSite?a.webSite:"#")+'" target="_black"><img class="logo" alt="'+("undefined"!=typeof a.webName?a.webName:"logo")+'" src="'+a.logo+'"/></a>':"");P(c.logoDiv,d);K(a);L(a.topAsk);M(a.newAdd);N(a.webConfig);O(a);b("#"+c.sendBtn).click(function(){F()});b("#"+c.clearScreen).click(function(){var a=b("<div/>").addClass("robot_question"),c=l.find("div").first().html();l.html("");a.html(c).appendTo(l)})}})};b.FaqRobot.defaults={basePath:"./",sysNum:2E6,
robotName:"FaqRobot",logoDiv:"weblogo",chatContDiv:"chatContentDiv",inputMsgArea:"inputMessage",inputMagOldvalue:"inputMagOldvalue",sendBtn:"sendBtn",closeBtn:"closeBtn",baseInfoDiv:"Contact_us",advInfoDiv:"advInfoDiv",topQuestionDiv:"topQuestions",newQuestionDiv:"newQuestions",sugQuestionDiv:"sugQuestions",viewUrlDiv:"viewUrlDiv",dataType:"json",extraParams:"",webUrl:"http://www.faqrobot.org",authUrl:"",maxTopQuestions:7,queConMaxWordsCount:0,showMyWords:function(b,c){},showRobotWords:!1,autoswitch:0,
wordremain:"wordremain",clearScreen:"clearScreen",fadeBackId:"fadeBackId",showErrorId:"showErrorId",kfUrl:"skin/fees1/image/logo.png",khUrl:"skin/mobileFees1/images/ask.png",sourceId:0,formatWebLog:!1,formatBaseQueCount:!1,showErrorMsg:!1}})(jQuery);