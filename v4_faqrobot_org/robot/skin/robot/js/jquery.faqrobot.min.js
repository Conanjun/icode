(function(c){c.fn.extend({faqrobot:function(x,d){d=c.extend({},c.FaqRobot.defaults,{sysNum:"number"==typeof x?x:1E4},d);return this.each(function(){new c.FaqRobot(this,d)})}});c.FaqRobot=function(x,d){function y(a,b,e,f,l){if("string"==typeof a&&0<a.length){var k={timestamp:+new Date,dataType:f||d.dataType},k=c.extend({},k,l);c.each(d.extraParams,function(a,b){k[a]="function"==typeof b?b():b});c.ajax({dataType:d.dataType,url:encodeURI(a),data:k,success:function(a){0>a.status&&"function"==typeof e?
e(a):-1==a.status?d.showErrorMsg&&d.showErrorMsg(a)||setTimeout(B(a.message||"\u8bf7\u6c42\u4fe1\u606f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\uff01"),2E3):-2==a.status?d.showErrorMsg&&d.showErrorMsg(a)||setTimeout(B(a.message||"\u60a8\u7684\u4fe1\u606f\u8ba4\u8bc1\u672a\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1\uff01",d.authUrl),2E3):(keepCount=0,D(a),"function"==typeof b&&b(a))},error:function(){d.showErrorMsg&&d.showErrorMsg(data)||B("\u6570\u636e\u8bf7\u6c42\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\uff01")}})}}
function B(a,b,e){w(a,function(){b&&"string"==typeof b&&(location.href=b)})}function E(a){a=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i");a=window.location.search.substr(1).match(a);return null!=a?a[2]:null}function O(a){if(d.quickLink&&2<d.quickLink.length&&"undefined"!=typeof a&&0<a.length){for(var b=[],e=0;e<a.length;e++)b.push('<li><a href="'+a[e].linkUrl+'" target="_blank"><img src="'+a[e].imageUrl+'"><br><span>'+a[e].name+"</span></li>");c("#"+d.quickLink+" ul").append(b.join(""))}}function P(a){var b=
c("<div/>").addClass("robot_question").html('<dl class="robot_questionL"><img src="'+d.kfUrl+'"></dl>'),e=c("<dl/>").addClass("robot_questionR").appendTo(b),f=c("<div/>").addClass("robot_questionR_qp").append('<div class="questionR_icon"></div>').appendTo(e),l=c("<div/>").addClass("questionR_txt").appendTo(f);c("<div/>").addClass("robot_questionR_time").html(r()).appendTo(e);c("<div/>").addClass("robot_review_none").after('<div class="clear"></div>').appendTo(f);d.chatContDiv&&2<d.chatContDiv.length&&
"undefined"!=typeof a.leaveQue&&1<a.leaveQue.length||l.html(a.webConfig.helloWord);q.html(b)}function Q(a){d.topQuestionDiv&&2<d.topQuestionDiv.length&&"undefined"!=typeof a&&1<a.length&&F(d.topQuestionDiv,a)}function R(a){d.newQuestionDiv&&2<d.newQuestionDiv.length&&"undefined"!=typeof a&&1<a.length&&F(d.newQuestionDiv,a)}function S(a){var b="<dl>";if(d.baseInfoDiv&&2<d.baseInfoDiv.length&&("undefined"!=typeof a.webConfig&&(b="<dl>","undefined"!=typeof a.webConfig.webName&&(b+="<dt>\u540d\u79f0\uff1a"+
a.webConfig.webName+"</dt>"),"undefined"!=typeof a.webConfig.serviceTel&&(b+="<dt>\u7535\u8bdd\uff1a"+a.webConfig.serviceTel+"</dt>"),"undefined"!=typeof a.webConfig.webSite&&(b+='<dt>\u7f51\u5740\uff1a<a href="'+a.webConfig.webSite+'" target="_black">'+a.webConfig.webSite+"</a></dt>")),a.advList&&0<a.advList.length))for(var e=0;e<a.advList.length;e++){var f=a.advList[e].type;0==f?b+="<dt>"+a.advList[e].name+"\uff1a"+a.advList[e].value+"</dt>":1==f?b=0==a.advList[e].value.indexOf("<")&&0<a.advList[e].value.indexOf(">")?
b+("<dt>"+a.advList[e].name+"\uff1a"+a.advList[e].value+""):b+("<dt>"+a.advList[e].name+'\uff1a<a href="javascript:;" href="'+a.advList[e].value+'" target="_blank">'+a.advList[e].value+"</a></dt>"):2==f?b=0==a.advList[e].value.indexOf("<")&&0<a.advList[e].value.indexOf(">")?b+("<dt>"+a.advList[e].name+"\uff1a"+a.advList[e].value+""):b+("<dt>"+a.advList[e].name+'\uff1a<br><img src="'+a.advList[e].value+'">'):3==f&&(b=0==a.advList[e].value.indexOf("<")&&0<a.advList[e].value.indexOf(">")?b+("<dt>"+a.advList[e].name+
"\uff1a"+a.advList[e].value+""):b+("<dt>"+a.advList[e].name+'\uff1a<a href="http://wpa.qq.com/msgrd?v=3&uin='+a.advList[e].value+'&site=qq&menu=yes" target="_blank"><img alt="'+a.advList[e].name+'" src="images/Service1.png"></a>'))}b+="</dl>";c("#"+d.baseInfoDiv).html(b)}function T(a){if(d.advInfoDiv&&2<d.advInfoDiv.length&&"undefined"!=typeof a.webConfig&&1<a.webConfig.length){var b="<table>";"undefined"!=typeof a.webConfig.serviceQq&&(b+='<tr><td>Q\u00a0Q\uff1a</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+
a.webConfig.serviceQq+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+a.webConfig.serviceQq+':51" alt="QQ\u5728\u7ebf\u5ba2\u670d" title="QQ\u5728\u7ebf\u5ba2\u670d"/></a></td></tr>');if("undefined"!=typeof a.advs)for(a=a.advs,i=0;i<a.length;i++){var e=c.trim(a[i].name),f=c.trim(a[i].value),l=a[i].type;0==l?b+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":1==l?b+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":2==l?b+="<tr><td>"+e+"\uff1a</td><td>"+f+"</td></tr>":3==l&&(b+="<tr><td>"+
e+'\uff1a</td><td><a target="_blank" href="http://wpa.qq.com/msgrd?v=3&uin='+f+'&site=qq&menu=yes"><img border="0" src="http://wpa.qq.com/pa?p=2:'+f+':51" alt="'+e+'" title="'+e+'"/></a></td></tr>')}b+="</table>";c("#"+d.advInfoDiv).html(b)}}function F(a,b,e,f,l){if(!b)return"";a=c("<dl/>").appendTo(c("#"+a));e=G(b.length);for(f=0;f<e;f++)if(b[f]){l=c("<dt/>");var k=d.formatBaseQueCount&&d.formatBaseQueCount(b[f],f+1,e,d.queConMaxWordsCount)||H(b[f].question);!1!==k&&(c("<a/>").html(k).appendTo(l).attr("href",
"javascript:void(0)").attr("title",b[f].question).attr("aid",b[f].solutionId).click(function(){$this=c(this);t($this.attr("title"),$this.attr("aid"));return!1}),l.appendTo(a))}}function H(a,b){return b?a.length>b?a.substring(0,b)+"...":a:a}function G(a){return d.maxTopQuestions&&d.maxTopQuestions<a?d.maxTopQuestions:a}function r(){var a=new Date,b=a.getFullYear(),e=a.getMonth()+1,c=a.getDate(),d=a.getHours(),k=a.getMinutes(),a=a.getSeconds();return b+"-"+e+"-"+c+" "+d+":"+k+":"+a}function w(a,b){C.fadeIn(800);
C.find("span").html(a);C.delay(1E3).fadeTo("slow",.2).fadeTo("slow",1).fadeOut(800,function(){"function"==typeof b&&b()})}function I(){var a="",a=p.val(),a=$xss(a,"html");""!=a&&a!=d.inputMagOldvalue&&(p.val(""),c(".ac_results").hide(),1==a.length&&0<a&&"undefined"!=typeof u[a-1]&&(a=u[a-1],u=[]),t(a),c("#"+d.wordremain).html(100),p.focus())}function t(a,b){if(a&&0<a.length){var e=d.basePath+"AQ?s=aq";b&&0<b++&&(e+="&sId="+b+"&sysNum="+d.sysNum);z(a);y(e,v,0,d.dataType,{question:a})}}function z(a){if(a||
0!=a.length){var b;(b=d.showMyWords&&d.showMyWords(a,r()))||(b=r(),b='<div class="robot_ask"><dl class="robot_askL"><dt>'+a+"<span></span></dt><dd>"+b+'</dd></dl><dl class="robot_askR"><img src="'+d.khUrl+'" class="fixpng"/></dl></div>');q.append(b);A.scrollTop(A[0].scrollHeight);J()}}function v(a){if(a||0!=a.length){var b;if(!(b=d.showRobotWords&&d.showRobotWords(a,r())))if(b=r(),"undefined"==typeof a.robotAnswer||0==a.robotAnswer.length)b="";else{for(var e,c,l=0;l<a.robotAnswer.length;l++)c=a.robotAnswer[l],
c=U(c,b),e?e.after(c):e=c;b=e}q.append(b);A.scrollTop(A[0].scrollHeight);J()}}function U(a,b){var e="",f="";"undefined"!=typeof a.gusWords&&null!=a.gusWords?(e=""==a.gusWords.ydWords?"\u60a8\u662f\u4e0d\u662f\u8981\u54a8\u8be2\u4e0b\u9762\u7684\u95ee\u9898\uff1f":a.gusWords.ydWords,f=""==a.gusWords.afterWords?"":a.gusWords.afterWords):(e="\u60a8\u662f\u4e0d\u662f\u8981\u54a8\u8be2\u4e0b\u9762\u7684\u95ee\u9898\uff1f",f="");if(!a)return"";var l=c("<div/>").addClass("robot_question").html('<dl class="robot_questionL"><img src="'+
d.kfUrl+'"></dl>'),k=c("<dl/>").addClass("robot_questionR").appendTo(l),m=c("<div/>").addClass("robot_questionR_qp").append('<div class="questionR_icon"></div>').appendTo(k),g=c("<div/>").addClass("questionR_txt").appendTo(m);c("<div/>").addClass("robot_questionR_time").html(r()).appendTo(k);var h=c("<div/>");""!=a.ansCon&&0<a.ansCon.length&&g.html(a.ansCon);if("undefined"!=typeof a.aId&&0!=a.aId){var k=a.aId,n=a.cluid;h.addClass("helper_aid_"+k);c("<a/>").addClass("robot_review_yes").attr("helptag",
1).attr("aid",k).attr("uid",n).click(K).html("<span></span>\u6ee1\u610f").appendTo(h);c("<a/>").addClass("robot_review_no").attr("helptag",0).attr("aid",k).attr("uid",n).click(K).html("<code></code>\u4e0d\u6ee1\u610f").appendTo(h);h.addClass("robot_review2")}else h.addClass("robot_review_none");h.after('<div class="clear"></div>').appendTo(m);if("undefined"!=typeof a.aId&&0!=a.aId&&d.sugQuestionDiv&&2<d.sugQuestionDiv.length&&"undefined"!=typeof a.relateLessList&&1<a.relateLessList.length){f=c("<div/>").addClass("relateTxt").appendTo(m);
h=a.relateLessList;if(!h)return"";n=c("<dl/>").appendTo(f);m=c("<dt/>").html("\u4f60\u662f\u5426\u8fd8\u60f3\u95ee\u5982\u4e0b\u95ee\u9898\uff1a").appendTo(n).css("color","red");m=G(h.length);for(g=0;g<m;g++)if(h[g]){var p=d.formatBaseQueCount&&d.formatBaseQueCount(h[g],g+1,m,d.queConMaxWordsCount)||H(h[g].question);!1!==p&&(k=c("<dd/>").appendTo(n).html(g+1+".\u00a0"),e=c("<a/>"),e.html(p).appendTo(k).attr("href","javascript:void(0)").attr("title",h[g].question).attr("aid",h[g].solutionId).click(function(){$this=
c(this);t($this.attr("title"),$this.attr("aid"));return!1}),u[g]=h[g].question)}f.after(c("<div/>").addClass("clear"));return l}if(0<a.relateList.length){m=c("<dl/>").append("<dt>"+e+"</dt>").appendTo(g);h=a.relateList;for(g=0;g<h.length;g++)n=c.trim(h[g].question),k=h[g].solutionId,k=c("<dd/>").appendTo(m).html(g+1+".\u00a0"),e=c("<a/>"),e.html(n).appendTo(k).attr("href","javascript:void(0)").attr("title",n).attr("aid",h[g].solutionId).click(function(){$this=c(this);t($this.attr("title"),$this.attr("aid"));
return!1}),u[g]=n;c("<dt/>").html(f).appendTo(m);return l}if(0<a.gusList.length){m=c("<dl/>").append("<dt>"+e+"</dt>").appendTo(g);h=a.gusList;for(g=0;g<h.length;g++)n=c.trim(h[g].seedQuestion.question),k=h[g].solutionId,k=c("<dd/>").appendTo(m).html(g+1+".\u00a0"),e=c("<a/>"),e.html(n).appendTo(k).attr("href","javascript:void(0)").attr("title",n).attr("aid",h[g].solutionId).click(function(){$this=c(this);t($this.attr("title"),$this.attr("aid"));return!1}),u[g]=n;c("<dt/>").html(f).appendTo(m);return l}if(""==
a.ansCon)return f=a,"undefined"!=typeof f.sq&&(f='\u5173\u4e8e\u95ee\u9898\u00a0\u00a0"<b>'+data.sq+'</b>"\u00a0\u7684\u56de\u590d\uff1a</br>'+f),g.html("\u00a0"),l;g.html(a.ansCon);return l}function L(){var a=d.basePath+"AQ?s=offline&nocache="+(new Date).getTime();c.getJSON(a,function(a){0==a.status&&(a=eval('({"robotAnswer":{"ansCon":"\u60a8\u5df2\u4e0b\u7ebf\uff0c\u611f\u8c22\u60a8\u7684\u4f7f\u7528\uff01\u5982\u679c\u9700\u8981\u518d\u6b21\u804a\u5929\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u6216\u5237\u65b0\u672c\u9875\u9762\uff01","status":0,"tspan":2}})'),
v(a))})}function D(a){"undefined"!=typeof a.tspan&&(s_tspan!=a.tspan&&(s_tspan=a.tspan),"undefined"!=typeof dt&&clearTimeout(dt),100>s_tspan&&240>keepCount?(keepCount++,dt=setTimeout(V,1E3*s_tspan)):L())}function V(){var a=c.trim(p.text());c.ajax({type:"post",datatype:"json",cache:!1,url:d.basePath+"AQ?s=kl",data:"question="+encodeURI(a),success:function(a){0==a.status?(D(a),a.robotAnswer&&0<a.robotAnswer.length&&v(a)):(a=eval('({"robotAnswer":{"ansCon":"\u60a8\u5df2\u4e0b\u7ebf\uff0c\u611f\u8c22\u60a8\u7684\u4f7f\u7528\uff01\u5982\u679c\u9700\u8981\u518d\u6b21\u804a\u5929\uff0c\u8bf7\u91cd\u65b0\u6253\u5f00\u6216\u5237\u65b0\u672c\u9875\u9762\uff01","status":0,"tspan":2}})'),
v(a))}})}function K(){$this=c(this);var a=$this.attr("aid"),b=$this.attr("helptag"),e=$this.attr("uid");c(".helper_aid_"+a).text("\u611f\u8c22\u60a8\u7684\u8bc4\u4ef7!").css("color","#666");var f="",f=1==b?d.basePath+"AQ?s=addufc&aId="+a+"&cluid="+e+"&sysNum="+d.sysNum:d.basePath+"AQ?s=addulc&aId="+a+"&cluid="+e+"&sysNum="+d.sysNum;y(f)}function W(){$this=c(this);var a=$this.parents("form"),b=d.basePath+"AQ?s=fadeback&sysNum="+d.sysNum,e="",f=c("input[name='reason[]']");for(i=0;i<f.length;i++)f[i].checked&&
(e+=f[i].value+",");a.find("input[name=sub]").val(e);c.ajax({type:"get",datatype:"json",cache:!1,url:encodeURI(b),data:a.serialize(),success:function(b){c(".fadeBackModal").fadeOut(800);c(".fadeBackContent").fadeOut(800);a[0].reset();w(b.message)}})}function J(){c(".nano").nanoScroller({alwaysVisible:!0})}var u=[],q=c("#"+d.chatContDiv),A=q.parent(),p=c(x),C=c("#"+d.showErrorId),M=window.location.href.split("?"),N=[],N=-1!==M[1].indexOf("jid=")?M[1].split("&"):[""];p.focus(function(){c(this).val()==
c(this).attr("oldvalue")&&c(this).val("");c(this).css("color","#333");c(this).parent().addClass("robot_inputon")}).blur(function(){""==c(this).val()?(c(this).val(c(this).attr("oldvalue")),c(this).css("color","#ccc")):c(this).css("color","#333");c(this).parent().removeClass("robot_inputon")}).autocomplete(d.basePath+"AQ?s=ig&sysNum="+d.sysNum,{max:10,delay:500,matchSubset:!1,scroll:!1,minChars:2,scrollHeight:400,dataType:"json",selectFirst:!1,highlight:function(a,b){var e=b.split(""),d="";c.each(e,
function(b,c){-1==d.indexOf(c)&&(d+=c,a=a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+c.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>"))});return a.replace("<strong></strong>","")},parse:function(a){for(var b=[],c=0;c<a.list.length;c++)b[b.length]={data:a.list[c],result:a.list[c].question};return b},formatItem:function(a,b,c){return b+". "+a.question},formatMatch:function(a,b,c){return a},formatResult:function(a){return a}}).result(function(a,
b,c){a.preventDefault()}).keyup(function(a){a=a||window.event;27==a.keyCode&&c(this).unautocomplete();return(isHotKey="Enter"==hkey&&!a.ctrlKey&&13==a.keyCode||"CtrlEnter"==hkey&&a.ctrlKey&&13==a.keyCode)?(I(),!1):!0}).keydown(function(){var a=this.value.length,b=0,e=this.value.match(/[\u4E00-\u9FA5\uF900-\uFA2D]/g);null!=e&&(b+=e.length);a=c(this).attr("maxLength")-b-a;if(0>=a){a=0;b=this.value.substring(0,this.maxLength);for(e=0;e<b.length&&!(a+=/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(b.charAt(e))?
2:1,a>this.maxLength);e++);this.value=b.substring(0,e);c("#"+d.wordremain).html(0)}else c("#"+d.wordremain).html(a)});d.fadeBackId&&2<d.fadeBackId.length&&c("#"+d.fadeBackId).click(W);var X=function(){var a=E("qa"),b=E("q");a&&(a=decodeURI(a),z(a),t(a));b&&(b=decodeURI(b),p.val(b))};c(".faqevent").live("click",function(){var a=c(this).attr("href"),b=c(this).html(),a=d.basePath+"AQ?"+a+"&sysNum="+d.sysNum+"&nocache="+(new Date).getTime();z(b);y(a,v,0,d.dataType,{});return!1});c(".wflink").live("click",
function(){$this=c(this);var a=$this.attr("rel"),b=$this.html(),a=d.basePath+"AQ?s=getflw&sysNum="+d.sysNum+"&question="+encodeURI(b)+"&fid="+a+"&nocache="+(new Date).getTime();c.getJSON(a,function(a){0==a.status?(z(b),v(a)):w(a.message)})});window.onbeforeunload=function(a){L()};-1!==window.location.href.indexOf("sysNum=")&&(d.sysNum=window.location.href.split("sysNum=")[1].replace("#",""));p.attr("oldvalue",d.inputMagOldvalue);p.text(d.inputMagOldvalue);y(d.basePath+"AQ?s=p&sysNum="+d.sysNum+"&"+
N[0],function(a){urlId=location.href.split("?");-1==a.status?w("\u7f51\u7edc\u6709\u70b9\u4e0d\u7ed9\u529b\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u5c1d\u8bd5\u3002"):-2==a.status?(w("\u60a8\u7684\u4fe1\u606f\u8ba4\u8bc1\u672a\u901a\u8fc7\uff0c\u8bf7\u91cd\u65b0\u8ba4\u8bc1\uff01"),location.href=a.loginurl):("undefined"!=typeof a.webConfig.robotName&&(d.robotName=a.webConfig.robotName),"undefined"!=typeof a.webConfig.logoUrl&&(d.logoUrl=""==a.webConfig.logoUrl?"skin/robot/image/logo.png":a.webConfig.logoUrl,
c("#"+d.logoDiv).attr("src",d.logoUrl)),"undefined"!=typeof a.skinConfig&&("undefined"!=typeof a.skinConfig.kfPic&&(d.kfUrl=""==a.skinConfig.kfPic?d.kfUrl:a.skinConfig.kfPic),"undefined"!=typeof a.skinConfig.khPic&&(d.khUrl=""==a.skinConfig.khPic?d.khUrl:a.skinConfig.khPic)),c(document).attr("title",a.webConfig.webName),X(),P(a),Q(a.topAsk),R(a.newAdd),S(a),T(a),O(a.quickLink),c("#"+d.sendBtn).click(function(){I()}),c("#"+d.clearScreen).click(function(){var a=c("<div/>").addClass("robot_question"),
d=q.find("div").first().html();q.html("");a.html(d).appendTo(q)}))})};c.FaqRobot.defaults={basePath:"./",sysNum:2E6,robotName:"FaqRobot",logoUrl:"skin/robot/image/logo.png",logoDiv:"weblogo",chatContDiv:"chatContentDiv",inputMsgArea:"inputMessage",inputMagOldvalue:"inputMagOldvalue",sendBtn:"sendBtn",closeBtn:"closeBtn",baseInfoDiv:"Contact_us",advInfoDiv:"advInfoDiv",topQuestionDiv:"topQuestions",newQuestionDiv:"newQuestions",sugQuestionDiv:"sugQuestions",viewUrlDiv:"viewUrlDiv",dataType:"json",
extraParams:"",webUrl:"http://www.faqrobot.org",authUrl:"",maxTopQuestions:7,queConMaxWordsCount:0,showMyWords:function(c,d){},showRobotWords:!1,autoswitch:0,wordremain:"wordremain",clearScreen:"clearScreen",fadeBackId:"fadeBackId",showErrorId:"showErrorId",advFaqrobot:"advFaqrobot",kfUrl:"skin/robot/image/logo.png",khUrl:"skin/robot/image/robot_askicon.png",quickLink:"quickLink",formatWebLog:!1,formatBaseQueCount:!1,showErrorMsg:!1}})(jQuery);